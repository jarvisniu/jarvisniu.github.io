<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Polyline Morph</title>
    <meta charset="utf-8">
    <script src="../build/bu.js"></script>
    <script src="./lib/morph/PolylineMorph.js"></script>
    <script src="js/ClipMeter.min.js"></script>
    <style>
      html, body, #container {
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }
      
      #info {
        position: absolute;
        width: 100%;
        text-align: center;
        padding: 8px 0;
      }
      
    </style>
    <script type="text/javascript">
      var bu;
      var polylineA, polylineB, polylineMorph;
      var splineA, splineB, splineM;
      var time = 0, forward = true;
      
      $.ready(init);
      
      function init() {
        bu = new Bu({
          container: "#container",
          showKeyPoints: true,
          fillParent: true
        });
        bu.dom.addEventListener("mousedown", onMouseDown);
      
        polylineA = new Bu.Polyline();
        polylineA.addPoint(new Bu.Point(100, 300));
        polylineA.addPoint(new Bu.Point(250, 100));
        polylineA.addPoint(new Bu.Point(400, 300));
      
        polylineB = new Bu.Polyline().stroke("red");
        polylineB.addPoint(new Bu.Point(100, 400));
        polylineB.addPoint(new Bu.Point(250, 350));
        polylineB.addPoint(new Bu.Point(400, 400));
      
        polylineMorph = new Bu.PolylineMorph(polylineA, polylineB);
        polylineMorph.polyline.stroke("purple");
      
        bu.add(polylineA);
        bu.add(polylineB);
        bu.add(polylineMorph.polyline);
      
        splineA = new Bu.Spline(polylineA);
        splineB = new Bu.Spline(polylineB).stroke("red");
        splineM = new Bu.Spline(polylineMorph.polyline).stroke("purple");
      
        splineA.visible = splineB.visible = splineM.visible = false;
      
        bu.add(splineA);
        bu.add(splineB);
        bu.add(splineM);
      
        refreshLabel();
      
        setInterval(animate, 1000 / 60);
      }
      
      function onMouseDown(e) {
      
        var newPoint = new Bu.Point(e.offsetX, e.offsetY);
        if (e.button == 0) {
          polylineA.addPoint(newPoint);
        } else {
          polylineB.addPoint(newPoint);
        }
        refreshLabel();
        polylineMorph.update();
      }
      
      function refreshLabel() {
        for (var i in polylineA.vertices) {
          if (!polylineA.vertices.hasOwnProperty(i)) continue;
          polylineA.vertices[i].label = i;
        }
        for (i in polylineB.vertices) {
          if (!polylineB.vertices.hasOwnProperty(i)) continue;
          polylineB.vertices[i].label = i;
        }
      }
      
      function animate() {
        if (forward == true) {
          time += 0.01;
          if (time > 1.2) forward = false;
        } else {
          time -= 0.01;
          if (time < -0.2) forward = true;
        }
        polylineMorph.setTime(Math.min(1, Math.max(0, time)));
      }
      
      function onRadioSwitch() {
        if (document.getElementById('radioPolyline').checked) {
          polylineA.visible = polylineB.visible = polylineMorph.polyline.visible = true;
          splineA.visible = splineB.visible = splineM.visible = false;
        } else {
          polylineA.visible = polylineB.visible = polylineMorph.polyline.visible = false;
          splineA.visible = splineB.visible = splineM.visible = true;
        }
      }
      
    </script>
  </head>
  <body>
    <div id="info">Click (left/right button) to add points to the lines.
      <div id="switch">Line style:
        <label>
          <input id="radioPolyline" type="radio" name="lineType" onclick="onRadioSwitch()" checked>Polyline
        </label>
        <label>
          <input type="radio" name="lineType" onclick="onRadioSwitch()">Spline
        </label>
      </div>
    </div>
    <div id="container"></div>
  </body>
</html>