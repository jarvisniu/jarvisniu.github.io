
/**
 * NetHoneycomb - a net consists of hexagons like a honeycomb.
 * @param w - Width of the honeycomb net.
 * @param h - Height of the honeycomb net.
 * @constructor
 */

(function() {
  AStar.NetHoneycomb = function(w, h) {
    this.engine = null;
    this.nodes = [];
    this.width = w || 15;
    this.height = h || 10;
    this.startNode = null;
    this.endNode = null;
    this.setStart = function(x, y) {
      var node;
      node = this.getNode(x, y);
      if (node.state !== AStar.NODE_STATE_DEFAULT) {
        return;
      }
      if (this.startNode != null) {
        if (this.startNode.position.x === x && this.startNode.position.y === y) {
          return;
        }
        this.startNode.state = AStar.NODE_STATE_DEFAULT;
        this.engine.trigger('nodeChanged', this.startNode.position);
      }
      this.startNode = node;
      node.state = AStar.NODE_STATE_START;
      this.engine.trigger('nodeChanged', node.position);
    };
    this.setEnd = function(x, y) {
      var node;
      node = this.getNode(x, y);
      if (node.state !== AStar.NODE_STATE_DEFAULT) {
        return;
      }
      if (this.endNode != null) {
        if (this.endNode.position.x === x && this.endNode.position.y === y) {
          return;
        }
        this.endNode.state = AStar.NODE_STATE_DEFAULT;
        this.engine.trigger('nodeChanged', this.endNode.position);
      }
      this.endNode = node;
      node.state = AStar.NODE_STATE_END;
      this.engine.trigger('nodeChanged', node.position);
    };
    this.getNode = function(x, y) {
      var base;
      (base = this.nodes)[x] || (base[x] = []);
      if (this.nodes[x][y] == null) {
        this.nodes[x][y] = new AStar.Node(this);
        this.nodes[x][y].position.x = x;
        this.nodes[x][y].position.y = y;
      }
      return this.nodes[x][y];
    };
    this.getNeighboursOf = function(node) {
      var i, j, k, l, neighbour, ref, ref1, ref2, ref3, x, xFrom, xTo, y, yFrom, yTo;
      if (node.neighbours != null) {
        return node.neighbours;
      }
      x = node.position.x;
      y = node.position.y;
      xFrom = x - 1;
      xTo = x + 1;
      yFrom = y - 1;
      yTo = y + 1;
      if (xFrom < 0) {
        xFrom = 0;
      }
      if (xFrom > this.width - 1) {
        xFrom = this.width - 1;
      }
      if (xTo < 0) {
        xTo = 0;
      }
      if (xTo > this.width - 1) {
        xTo = this.width - 1;
      }
      if (yFrom < 0) {
        yFrom = 0;
      }
      if (yFrom > this.height - 1) {
        yFrom = this.height - 1;
      }
      if (yTo < 0) {
        yTo = 0;
      }
      if (yTo > this.height - 1) {
        yTo = this.height - 1;
      }
      node.neighbours = [];
      for (i = k = ref = xFrom, ref1 = xTo; ref <= ref1 ? k <= ref1 : k >= ref1; i = ref <= ref1 ? ++k : --k) {
        for (j = l = ref2 = yFrom, ref3 = yTo; ref2 <= ref3 ? l <= ref3 : l >= ref3; j = ref2 <= ref3 ? ++l : --l) {
          neighbour = this.getNode(i, j);
          if (i === x && j === y) {
            continue;
          }
          if (neighbour.state === AStar.NODE_STATE_OBSTACLE) {
            continue;
          }
          if ((i - x) * (j - y) > 0) {
            continue;
          }
          node.neighbours.push(neighbour);
        }
      }
      return node.neighbours;
    };
    this.calcShortestDistance = function(node1, node2) {
      var dx, dy;
      dx = node1.position.x - node2.position.x;
      dy = node1.position.y - node2.position.y;
      if (dx * dy < 0) {
        return Math.abs(Math.abs(dx + dy) + Math.min(Math.abs(dx), Math.abs(dy)));
      } else {
        return Math.abs(dx + dy);
      }
    };
    return this;
  };

}).call(this);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImEtc3Rhci9OZXRIb25leWNvbWIuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztBQUFBO0VBT0EsS0FBSyxDQUFDLFlBQU4sR0FBcUIsU0FBQyxDQUFELEVBQUksQ0FBSjtJQUNwQixJQUFDLENBQUEsTUFBRCxHQUFVO0lBQ1YsSUFBQyxDQUFBLEtBQUQsR0FBUztJQUVULElBQUMsQ0FBQSxLQUFELEdBQVMsQ0FBQSxJQUFLO0lBQ2QsSUFBQyxDQUFBLE1BQUQsR0FBVSxDQUFBLElBQUs7SUFFZixJQUFDLENBQUEsU0FBRCxHQUFhO0lBQ2IsSUFBQyxDQUFBLE9BQUQsR0FBVztJQUVYLElBQUMsQ0FBQSxRQUFELEdBQVksU0FBQyxDQUFELEVBQUksQ0FBSjtBQUNYLFVBQUE7TUFBQSxJQUFBLEdBQU8sSUFBQyxDQUFBLE9BQUQsQ0FBUyxDQUFULEVBQVksQ0FBWjtNQUNQLElBQVUsSUFBSSxDQUFDLEtBQUwsS0FBYyxLQUFLLENBQUMsa0JBQTlCO0FBQUEsZUFBQTs7TUFDQSxJQUFHLHNCQUFIO1FBQ0MsSUFBVSxJQUFDLENBQUEsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFwQixLQUF5QixDQUF6QixJQUE4QixJQUFDLENBQUEsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFwQixLQUF5QixDQUFqRTtBQUFBLGlCQUFBOztRQUNBLElBQUMsQ0FBQSxTQUFTLENBQUMsS0FBWCxHQUFtQixLQUFLLENBQUM7UUFDekIsSUFBQyxDQUFBLE1BQU0sQ0FBQyxPQUFSLENBQWdCLGFBQWhCLEVBQStCLElBQUMsQ0FBQSxTQUFTLENBQUMsUUFBMUMsRUFIRDs7TUFLQSxJQUFDLENBQUEsU0FBRCxHQUFhO01BRWIsSUFBSSxDQUFDLEtBQUwsR0FBYSxLQUFLLENBQUM7TUFDbkIsSUFBQyxDQUFBLE1BQU0sQ0FBQyxPQUFSLENBQWdCLGFBQWhCLEVBQStCLElBQUksQ0FBQyxRQUFwQztJQVhXO0lBY1osSUFBQyxDQUFBLE1BQUQsR0FBVSxTQUFD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IyBOZXRIb25leWNvbWIgLSBhIG5ldCBjb25zaXN0cyBvZiBoZXhhZ29ucyBsaWtlIGEgaG9uZXljb21iLlxyXG4jIEBwYXJhbSB3IC0gV2lkdGggb2YgdGhlIGhvbmV5Y29tYiBuZXQuXHJcbiMgQHBhcmFtIGggLSBIZWlnaHQgb2YgdGhlIGhvbmV5Y29tYiBuZXQuXHJcbiMgQGNvbnN0cnVjdG9yXHJcbiMjI1xyXG5cclxuQVN0YXIuTmV0SG9uZXljb21iID0gKHcsIGgpIC0+XHJcblx0QGVuZ2luZSA9IG51bGxcclxuXHRAbm9kZXMgPSBbXVxyXG5cclxuXHRAd2lkdGggPSB3IG9yIDE1XHJcblx0QGhlaWdodCA9IGggb3IgMTBcclxuXHJcblx0QHN0YXJ0Tm9kZSA9IG51bGxcclxuXHRAZW5kTm9kZSA9IG51bGxcclxuXHJcblx0QHNldFN0YXJ0ID0gKHgsIHkpIC0+XHJcblx0XHRub2RlID0gQGdldE5vZGUoeCwgeSlcclxuXHRcdHJldHVybiBpZiBub2RlLnN0YXRlICE9IEFTdGFyLk5PREVfU1RBVEVfREVGQVVMVFxyXG5cdFx0aWYgQHN0YXJ0Tm9kZT9cclxuXHRcdFx0cmV0dXJuIGlmIEBzdGFydE5vZGUucG9zaXRpb24ueCA9PSB4ICYmIEBzdGFydE5vZGUucG9zaXRpb24ueSA9PSB5XHJcblx0XHRcdEBzdGFydE5vZGUuc3RhdGUgPSBBU3Rhci5OT0RFX1NUQVRFX0RFRkFVTFRcclxuXHRcdFx0QGVuZ2luZS50cmlnZ2VyICdub2RlQ2hhbmdlZCcsIEBzdGFydE5vZGUucG9zaXRpb25cclxuXHJcblx0XHRAc3RhcnROb2RlID0gbm9kZVxyXG5cclxuXHRcdG5vZGUuc3RhdGUgPSBBU3Rhci5OT0RFX1NUQVRFX1NUQVJUXHJcblx0XHRAZW5naW5lLnRyaWdnZXIgJ25vZGVDaGFuZ2VkJywgbm9kZS5wb3NpdGlvblxyXG5cdFx0cmV0dXJuXHJcblxyXG5cdEBzZXRFbmQgPSAoeCwgeSkgLT5cclxuXHRcdG5vZGUgPSBAZ2V0Tm9kZSh4LCB5KVxyXG5cdFx0cmV0dXJuIGlmIG5vZGUuc3RhdGUgIT0gQVN0YXIuTk9ERV9TVEFURV9ERUZBVUxUXHJcblx0XHRpZiBAZW5kTm9kZT9cclxuXHRcdFx0cmV0dXJuIGlmIEBlbmROb2RlLnBvc2l0aW9uLnggPT0geCAmJiBAZW5kTm9kZS5wb3NpdGlvbi55ID09IHlcclxuXHRcdFx0QGVuZE5vZGUuc3RhdGUgPSBBU3Rhci5OT0RFX1NUQVRFX0RFRkFVTFRcclxuXHRcdFx0QGVuZ2luZS50cmlnZ2VyICdub2RlQ2hhbmdlZCcsIEBlbmROb2RlLnBvc2l0aW9uXHJcblxyXG5cdFx0QGVuZE5vZGUgPSBub2RlXHJcblxyXG5cdFx0bm9kZS5zdGF0ZSA9IEFTdGFyLk5PREVfU1RBVEVfRU5EXHJcblx0XHRAZW5naW5lLnRyaWdnZXIgJ25vZGVDaGFuZ2VkJywgbm9kZS5wb3NpdGlvblxyXG5cdFx0cmV0dXJuXHJcblxyXG5cdEBnZXROb2RlID0gKHgsIHkpIC0+XHJcblx0XHRAbm9kZXNbeF0gb3I9IFtdXHJcblx0XHRpZiBub3QgQG5vZGVzW3hdW3ldP1xyXG5cdFx0XHRAbm9kZXNbeF1beV0gPSBuZXcgQVN0YXIuTm9kZSB0aGlzXHJcblx0XHRcdEBub2Rlc1t4XVt5XS5wb3NpdGlvbi54ID0geFxyXG5cdFx0XHRAbm9kZXNbeF1beV0ucG9zaXRpb24ueSA9IHlcclxuXHRcdEBub2Rlc1t4XVt5XVxyXG5cclxuXHRAZ2V0TmVpZ2hib3Vyc09mID0gKG5vZGUpIC0+XHJcblx0XHRyZXR1cm4gbm9kZS5uZWlnaGJvdXJzIGlmIG5vZGUubmVpZ2hib3Vycz9cclxuXHJcblx0XHR4ID0gbm9kZS5wb3NpdGlvbi54XHJcblx0XHR5ID0gbm9kZS5wb3NpdGlvbi55XHJcblxyXG5cdFx0eEZyb20gPSB4IC0gMVxyXG5cdFx0eFRvID0geCArIDFcclxuXHRcdHlGcm9tID0geSAtIDFcclxuXHRcdHlUbyA9IHkgKyAxXHJcblxyXG5cdFx0eEZyb20gPSAwIGlmIHhGcm9tIDwgMFxyXG5cdFx0eEZyb20gPSBAd2lkdGggLSAxIGlmIHhGcm9tID4gQHdpZHRoIC0gMVxyXG5cdFx0eFRvID0gMCBpZiB4VG8gPCAwXHJcblx0XHR4VG8gPSBAd2lkdGggLSAxIGlmIHhUbyA+IEB3aWR0aCAtIDFcclxuXHJcblx0XHR5RnJvbSA9IDAgaWYgeUZyb20gPCAwXHJcblx0XHR5RnJvbSA9IEBoZWlnaHQgLSAxIGlmIHlGcm9tID4gQGhlaWdodCAtIDFcclxuXHRcdHlUbyA9IDAgaWYgeVRvIDwgMFxyXG5cdFx0eVRvID0gQGhlaWdodCAtIDEgaWYgeVRvID4gQGhlaWdodCAtIDFcclxuXHJcblx0XHRub2RlLm5laWdoYm91cnMgPSBbXVxyXG5cclxuXHRcdGZvciBpIGluIFt4RnJvbS4ueFRvXVxyXG5cdFx0XHRmb3IgaiBpbiBbeUZyb20uLnlUb11cclxuXHRcdFx0XHRuZWlnaGJvdXIgPSBAZ2V0Tm9kZShpLCBqKVxyXG5cdFx0XHRcdCMgbm90IGl0c2VsZlxyXG5cdFx0XHRcdGNvbnRpbnVlIGlmIGkgPT0geCBhbmQgaiA9PSB5XHJcblx0XHRcdFx0IyBub3Qgb2JzdGFjbGVcclxuXHRcdFx0XHRjb250aW51ZSBpZiBuZWlnaGJvdXIuc3RhdGUgPT0gQVN0YXIuTk9ERV9TVEFURV9PQlNUQUNMRVxyXG5cdFx0XHRcdGNvbnRpbnVlIGlmIChpIC0geCkgKiAoaiAtIHkpID4gMFxyXG5cdFx0XHRcdG5vZGUubmVpZ2hib3Vycy5wdXNoIG5laWdoYm91clxyXG5cdFx0bm9kZS5uZWlnaGJvdXJzXHJcblxyXG5cdEBjYWxjU2hvcnRlc3REaXN0YW5jZSA9IChub2RlMSwgbm9kZTIpIC0+XHJcblx0XHRkeCA9IG5vZGUxLnBvc2l0aW9uLnggLSAobm9kZTIucG9zaXRpb24ueClcclxuXHRcdGR5ID0gbm9kZTEucG9zaXRpb24ueSAtIChub2RlMi5wb3NpdGlvbi55KVxyXG5cdFx0aWYgZHggKiBkeSA8IDBcclxuXHRcdFx0cmV0dXJuIE1hdGguYWJzIE1hdGguYWJzKGR4ICsgZHkpICsgTWF0aC5taW4oTWF0aC5hYnMoZHgpLCBNYXRoLmFicyhkeSkpXHJcblx0XHRlbHNlXHJcblx0XHRcdHJldHVybiBNYXRoLmFicyBkeCArIGR5XHJcblxyXG5cdHJldHVybiB0aGlzXHJcbiJdfQ==
