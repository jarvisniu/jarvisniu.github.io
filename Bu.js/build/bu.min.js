// Bu.js v0.4.0 - https://github.com/jarvisniu/Bu.js
(function(){var t,e,i,n,r,s,o={}.hasOwnProperty,a=function(t,e){return function(){return t.apply(e,arguments)}},h=function(t,e){function i(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},u=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};r=window||this,r.Bu={global:r},Bu.VERSION="0.4.0",Bu.BROWSER_VENDOR_PREFIXES=["webkit","moz","ms"],Bu.HALF_PI=Math.PI/2,Bu.TWO_PI=2*Math.PI,Bu.DEFAULT_FONT_FAMILY="Verdana",Bu.DEFAULT_FONT_SIZE=11,Bu.DEFAULT_FONT="11px Verdana",Bu.POINT_RENDER_SIZE=2.25,Bu.POINT_LABEL_OFFSET=5,Bu.DEFAULT_SPLINE_SMOOTH=.25,Bu.DEFAULT_NEAR_DIST=5,Bu.MOUSE={NONE:0,LEFT:1,RIGHT:2,MIDDLE:4},Bu.average=function(){var t,e,i,n,r;for(i=arguments,"object"==typeof arguments[0]&&(i=arguments[0]),n=0,r=0,e=i.length;r<e;r++)t=i[r],n+=t;return n/i.length},Bu.bevel=function(t,e){return Math.sqrt(t*t+e*e)},Bu.clamp=function(t,e,i){return t<e&&(t=e),t>i&&(t=i),t},Bu.rand=function(t,e){var i;return null==e&&(i=[0,t],t=i[0],e=i[1]),Math.random()*(e-t)+t},Bu.r2d=function(t){return(180*t/Math.PI).toFixed(1)},Bu.d2r=function(t){return t*Math.PI/180},Bu.now=null!=Bu.global.performance?function(){return Bu.global.performance.now()}:function(){return Date.now()},Bu.combineOptions=function(t,e){var i,n;if(null==e&&(e={}),i=t[t.length-1],Bu.isPlainObject(i))for(n in i)null!=i[n]&&(e[n]=i[n]);return e},Bu.isNumber=function(t){return"number"==typeof t},Bu.isString=function(t){return"string"==typeof t},Bu.isPlainObject=function(t){return t instanceof Object&&"Object"===t.constructor.name},Bu.isFunction=function(t){return t instanceof Object&&"Function"===t.constructor.name},Bu.isArray=function(t){return t instanceof Array},Bu.clone=function(t){var e,i;if("object"!=typeof t||null===t||Bu.isFunction(t))return t;if(null!=t.clone)return t.clone();e=Bu.isArray(t)?[]:Bu.isPlainObject(t)?{}:Object.create(t.constructor.prototype);for(i in t)o.call(t,i)&&(e[i]=Bu.clone(t[i]));return e},Bu.data=function(t,e){return null!=e?localStorage["Bu."+t]=JSON.stringify(e):(e=localStorage["Bu."+t],null!=e?JSON.parse(e):null)},Bu.ready=function(t,e,i){return"complete"===document.readyState?t.apply(e,i):document.addEventListener("DOMContentLoaded",function(){return t.apply(e,i)})},Function.prototype.property=function(t,e){return Object.defineProperty(this.prototype,t,e)},Function.prototype.throttle=function(t){var e,i;return null==t&&(t=.5),e=0,i=0,function(n){return function(){if(e=Date.now(),e-i>1e3*t)return n.apply(null,arguments),i=e}}(this)},Function.prototype.debounce=function(t){var e,i,n;return null==t&&(t=.5),e=null,n=null,i=function(t){return function(){return t.apply(null,e)}}(this),function(){return e=arguments,clearTimeout(n),n=setTimeout(i,1e3*t)}},(e=Array.prototype).each||(e.each=function(t){var e;for(e=0;e<this.length;)t(this[e]),e++;return this}),(i=Array.prototype).map||(i.map=function(t){var e,i;for(e=[],i=0;i<this.length;)e.push(t(this[i])),i++;return this}),n=Date.now(),s=Bu.data("version.timestamp"),null!=s&&n-s<6e4||("function"==typeof console.info&&console.info("Bu.js v"+Bu.VERSION+" - [https://github.com/jarvisniu/Bu.js]"),Bu.data("version.timestamp",n)),Bu.Bounds=function(){function t(t){this.target=t,this.update=a(this.update,this),this.x1=this.y1=this.x2=this.y2=0,this.isEmpty=!0,this.point1=new Bu.Vector,this.point2=new Bu.Vector,this.update(),this.bindEvent()}return t.prototype.containsPoint=function(t){return this.x1<t.x&&this.x2>t.x&&this.y1<t.y&&this.y2>t.y},t.prototype.update=function(){var t,e,i,n,r,s,o,a,h;switch(this.clear(),this.target.type){case"Line":case"Triangle":case"Rectangle":for(i=this.target.points,r=[],o=0,t=i.length;o<t;o++)a=i[o],r.push(this.expandByPoint(a));return r;case"Circle":case"Bow":case"Fan":return this.expandByCircle(this.target);case"Polyline":case"Polygon":for(n=this.target.vertices,s=[],h=0,e=n.length;h<e;h++)a=n[h],s.push(this.expandByPoint(a));return s;case"Ellipse":return this.x1=-this.target.radiusX,this.x2=this.target.radiusX,this.y1=-this.target.radiusY,this.y2=this.target.radiusY;default:return console.warn("Bounds: not support shape type "+this.target.type)}},t.prototype.bindEvent=function(){switch(this.target.type){case"Circle":case"Bow":case"Fan":return this.target.on("centerChanged",this.update),this.target.on("radiusChanged",this.update);case"Ellipse":return this.target.on("changed",this.update)}},t.prototype.clear=function(){return this.x1=this.y1=this.x2=this.y2=0,this.isEmpty=!0,this},t.prototype.expandByPoint=function(t){return this.isEmpty?(this.isEmpty=!1,this.x1=this.x2=t.x,this.y1=this.y2=t.y):(t.x<this.x1&&(this.x1=t.x),t.x>this.x2&&(this.x2=t.x),t.y<this.y1&&(this.y1=t.y),t.y>this.y2&&(this.y2=t.y)),this},t.prototype.expandByCircle=function(t){var e,i;return e=t.center,i=t.radius,this.isEmpty?(this.isEmpty=!1,this.x1=e.x-i,this.x2=e.x+i,this.y1=e.y-i,this.y2=e.y+i):(e.x-i<this.x1&&(this.x1=e.x-i),e.x+i>this.x2&&(this.x2=e.x+i),e.y-i<this.y1&&(this.y1=e.y-i),e.y+i>this.y2&&(this.y2=e.y+i)),this},t}(),Bu.Color=function(){function t(){var t;this.r=this.g=this.b=255,this.a=1,1===arguments.length?(t=arguments[0],Bu.isString(t)?(this.parse(t),this.a=c(this.a)):t instanceof Bu.Color&&this.copy(t)):(this.r=arguments[0],this.g=arguments[1],this.b=arguments[2],this.a=arguments[3]||1)}var e,i,n,r,s,o,a,h,u,c,l,p;return t.prototype.parse=function(t){var c,p,d,f,y,g,m;return(c=t.match(o))?(this.r=+c[1],this.g=+c[2],this.b=+c[3],this.a=1):(c=t.match(r))?(p=+c[1],m=+c[2]/100,f=+c[3]/100,y=l(p,m,f),this.r=y[0],this.g=y[1],this.b=y[2],this.a=1):(c=t.match(a))?(this.r=+c[1],this.g=+c[2],this.b=+c[3],this.a=+c[4]):(c=t.match(s))?(p=+c[1],m=+c[2]/100,f=+c[3]/100,g=l(p,m,f),this.r=g[0],this.g=g[1],this.b=g[2],this.a=parseFloat(c[4])):(c=t.match(h))?(this.r=255*+c[1]/100,this.g=255*+c[2]/100,this.b=255*+c[3]/100,this.a=+c[4]):(c=t.match(u))?(this.r=255*+c[1]/100,this.g=255*+c[2]/100,this.b=255*+c[3]/100,this.a=1):(c=t.match(i))?(d=c[1],this.r=parseInt(d[0],16),this.r=16*this.r+this.r,this.g=parseInt(d[1],16),this.g=16*this.g+this.g,this.b=parseInt(d[2],16),this.b=16*this.b+this.b,this.a=1):(c=t.match(n))?(d=c[1],this.r=parseInt(d.substring(0,2),16),this.g=parseInt(d.substring(2,4),16),this.b=parseInt(d.substring(4,6),16),this.a=1):null!=e[t=t.toLowerCase().trim()]?(this.r=e[t][0],this.g=e[t][1],this.b=e[t][2],this.a=e[t][3],null==this.a&&(this.a=1)):console.error('Bu.Color.parse("'+t+'") error.'),this},t.prototype.clone=function(){return(new Bu.Color).copy(this)},t.prototype.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.setRGB=function(t,e,i){return this.r=parseInt(t),this.g=parseInt(e),this.b=parseInt(i),this.a=1,this},t.prototype.setRGBA=function(t,e,i,n){return this.r=parseInt(t),this.g=parseInt(e),this.b=parseInt(i),this.a=c(parseFloat(n)),this},t.prototype.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},t.prototype.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.a+")"},c=function(t){return Bu.clamp(t,0,1)},l=function(t,e,i){var n,r,s,o,a,h,u;for(t%=360,t/=360,s=i<.5?i*(1+e):i+e-i*e,r=2*i-s,a=[t+1/3,t,t-1/3],o=[],n=h=0;h<=2;n=++h)a[n]<0&&(a[n]+=1),a[n]>1&&(a[n]-=1);for(n=u=0;u<=2;n=++u)a[n]<1/6?o[n]=r+6*(s-r)*a[n]:a[n]<.5?o[n]=s:a[n]<2/3?o[n]=r+6*(s-r)*(2/3-a[n]):o[n]=r,o[n]=Math.round(255*o[n]);return o},p=function(t,e,i){var n,r,s,o,a;return s=Math.max(t,e,i),o=Math.min(t,e,i),n=s===o?0:s===t&&e>=i?60*(e-i)/(s-o):s===t&&e<i?60*(e-i)/(s-o)+360:s===e?60*(i-t)/(s-o)+120:60*(t-e)/(s-o)+240,r=.5*(s+o),a=0===r||s===o?0:r>0&&r<=.5?(s-o)/(2*r):(s-o)/(2-2*r),[n,a,r]},r=/hsl\(\s*(\d+),\s*(\d+)%,\s*(\d+)%\s*\)/i,s=/hsla\(\s*(\d+),\s*(\d+)%,\s*(\d+)%\s*,\s*([.\d]+)\s*\)/i,o=/rgb\(\s*(\d+),\s*(\d+),\s*(\d+)\s*\)/i,a=/rgba\(\s*(\d+),\s*(\d+),\s*(\d+)\s*,\s*([.\d]+)\s*\)/i,u=/rgb\(\s*(\d+)%,\s*(\d+)%,\s*(\d+)%\s*\)/i,h=/rgba\(\s*(\d+)%,\s*(\d+)%,\s*(\d+)%\s*,\s*([.\d]+)\s*\)/i,i=/#([0-9A-F]{3})\s*$/i,n=/#([0-9A-F]{6})\s*$/i,e={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},t}(),Bu.Size=function(){function t(t,e){this.width=t,this.height=e,this.type="Size"}return t.prototype.set=function(t,e){this.width=t,this.height=e},t}(),Bu.Vector=function(){function t(t,e){this.x=null!=t?t:0,this.y=null!=e?e:0}return t.prototype.clone=function(){return new Bu.Vector(this.x,this.y)},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.offset=function(t,e){return this.x+=t,this.y+=e,this},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},t.prototype.project=function(t){var e,i;return this.x*=t.scale.x,this.y*=t.scale.y,i=Bu.bevel(this.x,this.y),e=Math.atan2(this.y,this.x)+t.rotation,this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.x+=t.position.x,this.y+=t.position.y,this},t.prototype.unProject=function(t){var e,i;return this.x-=t.position.x,this.y-=t.position.y,i=Bu.bevel(this.x,this.y),e=Math.atan2(this.y,this.x)-t.rotation,this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.x/=t.scale.x,this.y/=t.scale.y,this},t}(),Bu.Event=function(){var t;return t={},this.on=function(e,i){var n;if(n=t[e]||(t[e]=[]),n.indexOf(i===-1))return n.push(i)},this.once=function(t,e){return e.once=!0,this.on(t,e)},this.off=function(e,i){var n,r;if(r=t[e],null!=i){if(null!=r&&(n=r.indexOf(i),n>-1))return r.splice(n,1)}else if(null!=r)return r.length=0},this.trigger=function(e,i){var n,r,s,o,a;if(s=t[e],null!=s){for(i||(i={}),i.target=this,o=[],a=0,n=s.length;a<n;a++)r=s[a],r.call(this,i),r.once?o.push(s.splice(s.indexOf(r),1)):o.push(void 0);return o}}},function(t){var e;return t.$=function(t){var i;return i=[],"string"==typeof t?i=[].slice.call(document.querySelectorAll(t)):t instanceof HTMLElement&&i.push(t),e.apply(i),i},e=function(){var t;return this.on=function(t){return function(e,i){return t.each(function(t){return t.addEventListener(e,i)}),t}}(this),this.off=function(t){return function(e,i){return t.each(function(t){return t.removeEventListener(e,i)}),t}}(this),t="svg line rect circle ellipse polyline polygon path text",this.append=function(e){return function(i){return e.each(function(n,r){var s,o;return o=t.indexOf(i.toLowerCase()),s=o>-1?document.createElementNS("http://www.w3.org/2000/svg",i):document.createElement(i),e[r]=n.appendChild(s)}),e}}(this),this.text=function(t){return function(e){return t.each(function(t){return t.textContent=e}),t}}(this),this.html=function(t){return function(e){return t.each(function(t){return t.innerHTML=e}),t}}(this),this.width=function(t){return function(e){return null!=e?(t.each(function(t){return t.style.width=e+"px"}),t):parseFloat(getComputedStyle(t[0]).width)}}(this),this.height=function(t){return function(e){return null!=e?(t.each(function(t){return t.style.height=e+"px"}),t):parseFloat(getComputedStyle(t[0]).height)}}(this),this.style=function(t){return function(e,i){return t.each(function(t){var n,r,s;r=t.getAttribute("style"),s={},r&&r.split(";").each(function(t){var e;return e=t.split(":"),s[e[0]]=e[1]}),s[e]=i,r="";for(n in s)r+=n+": "+s[n]+"; ";return t.setAttribute("style",r)}),t}}(this),this.hasClass=function(t){return function(e){var i,n,r;if(0===t.length)return!1;for(r=0;r<t.length;){if(i=t[r].getAttribute("class"),n=i.split(RegExp(" +")),!n.contains(e))return!1;r++}return t}}(this),this.addClass=function(t){return function(e){return t.each(function(t){var i,n;if(i=t.getAttribute("class"),n=i.split(RegExp(" +")),!n.contains(e))return n.push(e),t.setAttribute("class",n.join(" "))}),t}}(this),this.removeClass=function(t){return function(e){return t.each(function(t){var i,n;if(i=t.getAttribute("class")||"",n=i.split(RegExp(" +")),n.contains(e))return n.remove(e),n.length>0?t.setAttribute("class",n.join(" ")):t.removeAttribute("class")}),t}}(this),this.toggleClass=function(t){return function(e){return t.each(function(t){var i,n;return i=t.getAttribute("class"),n=i.split(RegExp(" +")),n.contains(e)?n.remove(e):n.push(e),n.length>0?t.setAttribute("class",n.join(" ")):t.removeAttribute("class")}),t}}(this),this.attr=function(t){return function(e,i){return null!=i?(t.each(function(t){return t.setAttribute(e,i)}),t):t[0].getAttribute(e)}}(this),this.hasAttr=function(t){return function(e){var i;if(0===t.length)return!1;for(i=0;i<t.length;){if(!t[i].hasAttribute(e))return!1;i++}return t}}(this),this.removeAttr=function(t){return function(e){return t.each(function(t){return t.removeAttribute(e)}),t}}(this),this.val=function(t){return function(){var e;return null!=(e=t[0])?e.value:void 0}}(this)},t.$.ready=function(t){return document.addEventListener("DOMContentLoaded",t)},t.$.ajax=function(t,e){var i;return e||("object"==typeof t?(e=t,t=e.url):e={}),e.method||(e.method="GET"),null==e.async&&(e.async=!0),i=new XMLHttpRequest,i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status){if(null!=e.success)return e.success(i.responseText,i.status,i)}else if(null!=e.error&&e.error(i,i.status),null!=e.complete)return e.complete(i,i.status)},i.open(e.method,t,e.async,e.username,e.password),i.send(null)}}(Bu.global),Bu.Object2D=function(){function t(){Bu.Styled.apply(this),Bu.Event.apply(this),this.visible=!0,this.opacity=1,this.position=new Bu.Vector,this.rotation=0,this._scale=new Bu.Vector(1,1),this.skew=new Bu.Vector,this.bounds=null,this.keyPoints=null,this.children=[],this.parent=null}return t.prototype.type="Object2D",t.prototype.fillable=!1,t.property("scale",{get:function(){return this._scale},set:function(t){return Bu.isNumber(t)?this._scale.x=this._scale.y=t:this._scale=t}}),t.prototype.translate=function(t,e){return this.position.x+=t,this.position.y+=e,this},t.prototype.rotate=function(t){return this.rotation+=t,this},t.prototype.scaleBy=function(t){return this.scale*=t,this},t.prototype.scaleTo=function(t){return this.scale=t,this},t.prototype.getScene=function(){var t;for(t=this;;){if(t instanceof Bu.Scene)break;t=t.parent}return t},t.prototype.addChild=function(t){var e,i,n;if(Bu.isArray(t))for(n=0,e=t.length;n<e;n++)i=t[n],this.children.push(i),i.parent=this;else this.children.push(t),t.parent=this;return this},t.prototype.removeChild=function(t){var e;return e=this.children.indexOf(t),e>-1&&this.children.splice(e,1),this},t.prototype.animate=function(t,e){var i;if(Bu.isArray(e)||(e=[e]),Bu.isString(t))t in Bu.animations?Bu.animations[t].applyTo(this,e):console.warn('Bu.animations["'+t+"\"] doesn't exists.");else if(Bu.isArray(t))for(i in t)o.call(t,i)&&this.animate(t[i],e);else t.applyTo(this,e);return this},t.prototype.createBounds=function(){return this.bounds=new Bu.Bounds(this),this},t.prototype.hitTest=function(t){var e;return e=this.getScene().renderer,e.originAtCenter&&t.offset(-e.width/2,-e.height/2),t.project(e.camera),t.unProject(this),this.containsPoint(t)},t.prototype.containsPoint=function(t){return!(null!=this.bounds&&!this.bounds.containsPoint(t))&&(!!this._containsPoint&&this._containsPoint(t))},t}(),Bu.Styled=function(){return this.strokeStyle=Bu.Styled.DEFAULT_STROKE_STYLE,this.fillStyle=Bu.Styled.DEFAULT_FILL_STYLE,this.dashStyle=!1,this.dashFlowSpeed=0,this.lineWidth=1,this.dashOffset=0,this.style=function(t){var e,i,n,r;for(Bu.isString(t)?(t=Bu.styles[t],null==t&&(t=Bu.styles["default"],console.warn("Bu.Styled: Bu.styles."+t+" doesn't exists, fell back to default."))):null==t&&(t=Bu.styles["default"]),n=["strokeStyle","fillStyle","dashStyle","dashFlowSpeed","lineWidth"],r=0,i=n.length;r<i;r++)e=n[r],this[e]=t[e];return this},this.stroke=function(t){switch(null==t&&(t=!0),null!=Bu.styles&&t in Bu.styles&&(t=Bu.styles[t].strokeStyle),t){case!0:this.strokeStyle=Bu.Styled.DEFAULT_STROKE_STYLE;break;case!1:this.strokeStyle=null;break;default:this.strokeStyle=t}return this},this.fill=function(t){switch(null==t&&(t=!0),null!=Bu.styles&&t in Bu.styles&&(t=Bu.styles[t].fillStyle),t){case!1:this.fillStyle=null;break;case!0:this.fillStyle=Bu.Styled.DEFAULT_FILL_STYLE;break;default:this.fillStyle=t}return this},this.dash=function(t){switch(null==t&&(t=!0),null!=Bu.styles&&t in Bu.styles&&(t=Bu.styles[t].dashStyle),Bu.isNumber(t)&&(t=[t,t]),t){case!1:this.dashStyle=null;break;case!0:this.dashStyle=Bu.Styled.DEFAULT_DASH_STYLE;break;default:this.dashStyle=t}return this},this.dashFlow=function(t){return t!==!0&&null!=t||(t=1),t===!1&&(t=0),Bu.dashFlowManager.setSpeed(this,t),this},this.setLineWidth=function(t){return this.lineWidth=t,this},this},Bu.Styled.DEFAULT_STROKE_STYLE="#048",Bu.Styled.DEFAULT_FILL_STYLE="rgba(64, 128, 192, 0.5)",Bu.Styled.DEFAULT_DASH_STYLE=[8,4],Bu.styles={"default":(new Bu.Styled).stroke().fill(),hover:(new Bu.Styled).stroke("hsla(0, 100%, 40%, 0.75)").fill("hsla(0, 100%, 75%, 0.5)"),text:(new Bu.Styled).stroke(!1).fill("black"),line:(new Bu.Styled).fill(!1),selected:(new Bu.Styled).setLineWidth(3),dash:(new Bu.Styled).dash()},Bu.App=function(){function t(t){var e,i,n,r,s;for(this.$options=null!=t?t:{},r=["renderer","data","objects","methods","events"],s=0,n=r.length;s<n;s++)i=r[s],(e=this.$options)[i]||(e[i]={});this.$objects={},this.$inputManager=new Bu.InputManager,Bu.ready(this.init,this)}return t.prototype.init=function(){var t,e,i,n,r;r=new Bu.Scene,r.background=this.$options.background||Bu.Scene.DEFAULT_BACKGROUND,this.$renderer=new Bu.Renderer(this.$options.renderer),this.$renderer.scene=r,r.renderer=this.$renderer,Bu.isFunction(this.$options.data)&&(this.$options.data=this.$options.data.apply(this));for(e in this.$options.data)this[e]=this.$options.data[e];for(e in this.$options.methods)this[e]=this.$options.methods[e];if(Bu.isFunction(this.$options.objects))this.$objects=this.$options.objects.apply(this);else for(i in this.$options.objects)this.$objects[i]=this.$options.objects[i];if(!this.$options.hierarchy){this.$options.hierarchy={};for(i in this.$objects)this.$options.hierarchy[i]={}}if(t=function(e){return function(n,r){var s;s=[];for(i in n)o.call(n,i)&&(r.addChild(e.$objects[i]),s.push(t(n[i],e.$objects[i])));return s}}(this),t(this.$options.hierarchy,this.$renderer.scene),null!=(n=this.$options.init)&&n.call(this),this.$inputManager.handleAppEvents(this,this.$options.events),null!=this.$options.update)return this.$renderer.on("update",function(t){return function(){return t.$options.update.apply(t,arguments)}}(this))},t}(),Bu.Audio=function(){function t(t){this.audio=document.createElement("audio"),this.url="",this.ready=!1,t&&this.load(t)}return t.prototype.load=function(t){return this.url=t,this.audio.addEventListener("canplay",function(t){return function(){return t.ready=!0}}(this)),this.audio.src=t},t.prototype.play=function(){return this.ready?this.audio.play():console.warn("The audio file "+this.url+" hasn't been ready.")},t}(),Bu.Camera=function(t){function e(){e.__super__.constructor.call(this),this.type="Camera"}return h(e,t),e}(Bu.Object2D),Bu.Renderer=function(){function t(){this.drawShape=a(this.drawShape,this),this.drawShapes=a(this.drawShapes,this);var t,e,i,n,r,s,o,h;for(Bu.Event.apply(this),this.type="Renderer",this.scene=new Bu.Scene(this),this.camera=new Bu.Camera,this.tickCount=0,this.isRunning=!0,this.pixelRatio=Bu.global.devicePixelRatio||1,"undefined"!=typeof ClipMeter&&null!==ClipMeter&&(this.clipMeter=new ClipMeter),r=Bu.combineOptions(arguments,{container:"body",showKeyPoints:!1,showBounds:!1,originAtCenter:!1,imageSmoothing:!0}),s=["container","width","height","showKeyPoints","showBounds","originAtCenter"],h=0,e=s.length;h<e;h++)i=s[h],this[i]=r[i];this.fillParent=!Bu.isNumber(r.width),this.pixelWidth=this.width*this.pixelRatio,this.pixelHeight=this.height*this.pixelRatio,this.dom=document.createElement("canvas"),this.dom.style.cursor=r.cursor||"default",this.dom.style.boxSizing="content-box",this.dom.oncontextmenu=function(){return!1},this.context=this.dom.getContext("2d"),this.context.textBaseline="top",Bu.isString(this.container)&&(this.container=document.querySelector(this.container)),this.fillParent&&this.container===document.body&&($("body").style("margin",0).style("overflow","hidden"),$("html, body").style("width","100%").style("height","100%")),n=function(t){return function(){var e,i;return e=t.dom.height/t.dom.width,i=t.container.clientHeight/t.container.clientWidth,i<e?(t.height=t.container.clientHeight,t.width=t.height/i):(t.width=t.container.clientWidth,t.height=t.width*i),t.pixelWidth=t.dom.width=t.width*t.pixelRatio,t.pixelHeight=t.dom.height=t.height*t.pixelRatio,t.dom.style.width=t.width+"px",t.dom.style.height=t.height+"px",t.render()}}(this),this.fillParent?(this.pixelWidth=this.container.clientWidth,this.pixelHeight=this.container.clientHeight,this.width=this.pixelWidth/this.pixelRatio,this.height=this.pixelHeight/this.pixelRatio,Bu.global.window.addEventListener("resize",n),this.dom.addEventListener("DOMNodeInserted",n)):(this.dom.style.width=this.width+"px",this.dom.style.height=this.height+"px",this.dom.width=this.pixelWidth,this.dom.height=this.pixelHeight),o=function(t){return function(){return t.isRunning&&(null!=t.clipMeter&&t.clipMeter.start(),t.render(),t.trigger("update",t),t.tickCount+=1,null!=t.clipMeter&&t.clipMeter.tick()),requestAnimationFrame(o)}}(this),o(),t=function(t){return function(){return t.container.appendChild(t.dom),t.imageSmoothing=r.imageSmoothing}}(this),setTimeout(t,1),Bu.animationRunner.hookUp(this),Bu.dashFlowManager.hookUp(this)}return t.prototype.pause=function(){return this.isRunning=!1},t.prototype["continue"]=function(){return this.isRunning=!0},t.prototype.toggle=function(){return this.isRunning=!this.isRunning},t.prototype.render=function(){return this.context.save(),this.clearCanvas(),this.originAtCenter&&this.context.translate(this.pixelWidth/2,this.pixelHeight/2),this.context.scale(this.pixelRatio,this.pixelRatio),this.context.scale(1/this.camera.scale.x,1/this.camera.scale.y),this.context.rotate(-this.camera.rotation),this.context.translate(-this.camera.position.x,-this.camera.position.y),this.drawShape(this.scene),this.context.restore(),this},t.prototype.clearCanvas=function(){return this.context.fillStyle=this.scene.background,this.context.fillRect(0,0,this.pixelWidth,this.pixelHeight),this},t.prototype.drawShapes=function(t){var e,i,n;if(null!=t)for(n=0,e=t.length;n<e;n++)i=t[n],this.context.save(),this.drawShape(i),this.context.restore();return this},t.prototype.drawShape=function(t){var e,i,n;if(!t.visible)return this;switch(this.context.translate(t.position.x,t.position.y),this.context.rotate(t.rotation),i=t.scale.x,n=t.scale.y,(i/n>100||i/n<.01)&&(Math.abs(i)<.02&&(i=0),Math.abs(n)<.02&&(n=0)),this.context.scale(i,n),this.context.globalAlpha*=t.opacity,null!=t.strokeStyle&&(this.context.strokeStyle=t.strokeStyle,this.context.lineWidth=t.lineWidth,null!=t.lineCap&&(this.context.lineCap=t.lineCap),null!=t.lineJoin&&(this.context.lineJoin=t.lineJoin)),this.context.beginPath(),t.type){case"Point":this.drawPoint(t);break;case"Line":this.drawLine(t);break;case"Circle":this.drawCircle(t);break;case"Ellipse":this.drawEllipse(t);break;case"Triangle":this.drawTriangle(t);break;case"Rectangle":this.drawRectangle(t);break;case"Fan":this.drawFan(t);break;case"Bow":this.drawBow(t);break;case"Polygon":this.drawPolygon(t);break;case"Polyline":this.drawPolyline(t);break;case"Spline":this.drawSpline(t);break;case"PointText":this.drawPointText(t);break;case"Image":this.drawImage(t);break;case"Object2D":case"Scene":break;default:console.log("drawShapes(): unknown shape: ",t.type,t)}return null!=t.fillStyle&&t.fillable&&(this.context.fillStyle=t.fillStyle,this.context.fill()),t.dashStyle?(this.context.lineDashOffset=t.dashOffset,"function"==typeof(e=this.context).setLineDash&&e.setLineDash(t.dashStyle),this.context.stroke(),this.context.setLineDash([])):null!=t.strokeStyle&&this.context.stroke(),null!=t.children&&this.drawShapes(t.children),this.showKeyPoints&&this.drawShapes(t.keyPoints),this.showBounds&&null!=t.bounds&&this.drawBounds(t.bounds),this},t.prototype.drawPoint=function(t){return this.context.arc(t.x,t.y,Bu.POINT_RENDER_SIZE,0,Bu.TWO_PI),this},t.prototype.drawLine=function(t){return this.context.moveTo(t.points[0].x,t.points[0].y),this.context.lineTo(t.points[1].x,t.points[1].y),this},t.prototype.drawCircle=function(t){return this.context.arc(t.cx,t.cy,t.radius,0,Bu.TWO_PI),this},t.prototype.drawEllipse=function(t){return this.context.ellipse(0,0,t.radiusX,t.radiusY,0,Bu.TWO_PI,!1),this},t.prototype.drawTriangle=function(t){return this.context.lineTo(t.points[0].x,t.points[0].y),this.context.lineTo(t.points[1].x,t.points[1].y),this.context.lineTo(t.points[2].x,t.points[2].y),this.context.closePath(),this},t.prototype.drawRectangle=function(t){return 0!==t.cornerRadius?this.drawRoundRectangle(t):(this.context.rect(t.pointLT.x,t.pointLT.y,t.size.width,t.size.height),this)},t.prototype.drawRoundRectangle=function(t){var e,i,n,r,s,o;return n=t.pointLT.x,r=t.pointRB.x,s=t.pointLT.y,o=t.pointRB.y,i=t.cornerRadius,this.context.moveTo(n,s+i),this.context.arcTo(n,s,n+i,s,i),this.context.lineTo(r-i,s),this.context.arcTo(r,s,r,s+i,i),this.context.lineTo(r,o-i),this.context.arcTo(r,o,r-i,o,i),this.context.lineTo(n+i,o),this.context.arcTo(n,o,n,o-i,i),this.context.closePath(),null!=t.strokeStyle&&t.dashStyle&&"function"==typeof(e=this.context).setLineDash&&e.setLineDash(t.dashStyle),this},t.prototype.drawFan=function(t){return this.context.arc(t.cx,t.cy,t.radius,t.aFrom,t.aTo),this.context.lineTo(t.cx,t.cy),this.context.closePath(),this},t.prototype.drawBow=function(t){return this.context.arc(t.cx,t.cy,t.radius,t.aFrom,t.aTo),this.context.closePath(),this},t.prototype.drawPolygon=function(t){var e,i,n,r;for(n=t.vertices,r=0,e=n.length;r<e;r++)i=n[r],this.context.lineTo(i.x,i.y);return this.context.closePath(),this},t.prototype.drawPolyline=function(t){var e,i,n,r;for(n=t.vertices,r=0,e=n.length;r<e;r++)i=n[r],this.context.lineTo(i.x,i.y);return this},t.prototype.drawSpline=function(t){var e,i,n,r;if(null!=t.strokeStyle)if(i=t.vertices.length,2===i)this.context.moveTo(t.vertices[0].x,t.vertices[0].y),this.context.lineTo(t.vertices[1].x,t.vertices[1].y);else if(i>2)for(this.context.moveTo(t.vertices[0].x,t.vertices[0].y),e=r=1,n=i-1;1<=n?r<=n:r>=n;e=1<=n?++r:--r)this.context.bezierCurveTo(t.controlPointsBehind[e-1].x,t.controlPointsBehind[e-1].y,t.controlPointsAhead[e].x,t.controlPointsAhead[e].y,t.vertices[e].x,t.vertices[e].y);return this},t.prototype.drawPointText=function(t){var e,i,n,r,s,o,a,h,u;if(n=t.font||Bu.DEFAULT_FONT,Bu.isString(n))this.context.textAlign=t.textAlign,this.context.textBaseline=t.textBaseline,this.context.font=n,null!=t.strokeStyle&&this.context.strokeText(t.text,t.x,t.y),null!=t.fillStyle&&(this.context.fillStyle=t.fillStyle,this.context.fillText(t.text,t.x,t.y));else if(n instanceof Bu.SpriteSheet&&n.ready)for(o=n.measureTextWidth(t.text),h=function(){switch(t.textAlign){case"left":return 0;case"center":return-o/2;case"right":return-o}}(),u=function(){switch(t.textBaseline){case"top":return 0;case"middle":return-n.height/2;case"bottom":return-n.height}}(),r=a=0,s=t.text.length;0<=s?a<s:a>s;r=0<=s?++a:--a)e=t.text[r],i=n.getFrameImage(e),null!=i?(this.context.drawImage(i,t.x+h,t.y+u),h+=i.width):h+=10;return this},t.prototype.drawImage=function(t){var e,i,n,r;return t.ready&&(r=t.size.width,n=t.size.height,e=-r*t.pivot.x,i=-n*t.pivot.y,this.context.drawImage(t.image,e,i,r,n)),this},t.prototype.drawBounds=function(t){var e;return this.context.beginPath(),this.context.strokeStyle=Bu.Renderer.BOUNDS_STROKE_STYLE,"function"==typeof(e=this.context).setLineDash&&e.setLineDash(Bu.Renderer.BOUNDS_DASH_STYLE),this.context.rect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),this.context.stroke(),this},t.property("imageSmoothing",{get:function(){return this._imageSmoothing},set:function(t){return this._imageSmoothing=this.context.imageSmoothingEnabled=t}}),t}(),Bu.Renderer.BOUNDS_STROKE_STYLE="red",Bu.Renderer.BOUNDS_DASH_STYLE=[6,6],Bu.Scene=function(t){function e(){e.__super__.constructor.call(this),this.type="Scene",this.background=Bu.Scene.DEFAULT_BACKGROUND,this.renderer=null}return h(e,t),e}(Bu.Object2D),Bu.Scene.DEFAULT_BACKGROUND="#eee",Bu.Bow=function(t){function e(t,i,n,r,s){var o;this.cx=t,this.cy=i,this.radius=n,this.aFrom=r,this.aTo=s,e.__super__.constructor.call(this),this.aFrom>this.aTo&&(o=[this.aTo,this.aFrom],this.aFrom=o[0],this.aTo=o[1]),this.center=new Bu.Point(this.cx,this.cy),this.string=new Bu.Line(this.center.arcTo(this.radius,this.aFrom),this.center.arcTo(this.radius,this.aTo)),this.keyPoints=this.string.points,this.updateKeyPoints(),this.on("changed",this.updateKeyPoints),this.on("changed",function(t){return function(){var e;
return null!=(e=t.bounds)?e.update():void 0}}(this))}return h(e,t),e.prototype.type="Bow",e.prototype.fillable=!0,e.prototype.clone=function(){return new Bu.Bow(this.cx,this.cy,this.radius,this.aFrom,this.aTo)},e.prototype.updateKeyPoints=function(){return this.center.set(this.cx,this.cy),this.string.points[0].copy(this.center.arcTo(this.radius,this.aFrom)),this.string.points[1].copy(this.center.arcTo(this.radius,this.aTo)),this.keyPoints=this.string.points,this},e}(Bu.Object2D),Bu.Circle=function(t){function e(t,i,n){this._radius=null!=t?t:1,null==i&&(i=0),null==n&&(n=0),e.__super__.constructor.call(this),this._center=new Bu.Point(i,n),this.bounds=null,this.keyPoints=[this._center],this.on("centerChanged",this.updateKeyPoints)}return h(e,t),e.prototype.type="Circle",e.prototype.fillable=!0,e.prototype.clone=function(){return new Bu.Circle(this.radius,this.cx,this.cy)},e.prototype.updateKeyPoints=function(){return this.keyPoints[0].set(this.cx,this.cy)},e.property("cx",{get:function(){return this._center.x},set:function(t){return this._center.x=t,this.trigger("centerChanged",this)}}),e.property("cy",{get:function(){return this._center.y},set:function(t){return this._center.y=t,this.trigger("centerChanged",this)}}),e.property("center",{get:function(){return this._center},set:function(t){return this._center=t,this.cx=t.x,this.cy=t.y,this.keyPoints[0]=t,this.trigger("centerChanged",this)}}),e.property("radius",{get:function(){return this._radius},set:function(t){return this._radius=t,this.trigger("radiusChanged",this),this}}),e}(Bu.Object2D),Bu.Ellipse=function(t){function e(t,i){this._radiusX=null!=t?t:20,this._radiusY=null!=i?i:10,e.__super__.constructor.call(this)}return h(e,t),e.prototype.type="Ellipse",e.prototype.fillable=!0,e.property("radiusX",{get:function(){return this._radiusX},set:function(t){return this._radiusX=t,this.trigger("changed",this)}}),e.property("radiusY",{get:function(){return this._radiusY},set:function(t){return this._radiusY=t,this.trigger("changed",this)}}),e}(Bu.Object2D),Bu.Fan=function(t){function e(t,i,n,r,s){var o;this.cx=t,this.cy=i,this.radius=n,this.aFrom=r,this.aTo=s,e.__super__.constructor.call(this),this.aFrom>this.aTo&&(o=[this.aTo,this.aFrom],this.aFrom=o[0],this.aTo=o[1]),this.center=new Bu.Point(this.cx,this.cy),this.string=new Bu.Line(this.center.arcTo(this.radius,this.aFrom),this.center.arcTo(this.radius,this.aTo)),this.keyPoints=[this.string.points[0],this.string.points[1],this.center],this.on("changed",this.updateKeyPoints),this.on("changed",function(t){return function(){var e;return null!=(e=t.bounds)?e.update():void 0}}(this))}return h(e,t),e.prototype.type="Fan",e.prototype.fillable=!0,e.prototype.clone=function(){return new Bu.Fan(this.cx,this.cy,this.radius,this.aFrom,this.aTo)},e.prototype.updateKeyPoints=function(){return this.center.set(this.cx,this.cy),this.string.points[0].copy(this.center.arcTo(this.radius,this.aFrom)),this.string.points[1].copy(this.center.arcTo(this.radius,this.aTo)),this},e}(Bu.Object2D),Bu.Line=function(t){function e(t,i,n,r){e.__super__.constructor.call(this),arguments.length<2?this.points=[new Bu.Point,new Bu.Point]:arguments.length<4?this.points=[t.clone(),i.clone()]:this.points=[new Bu.Point(t,i),new Bu.Point(n,r)],this.length=0,this.midpoint=new Bu.Point,this.keyPoints=this.points,this.on("changed",function(t){return function(){return t.length=t.points[0].distanceTo(t.points[1]),t.midpoint.set((t.points[0].x+t.points[1].x)/2,(t.points[0].y+t.points[1].y)/2)}}(this)),this.trigger("changed")}return h(e,t),e.prototype.type="Line",e.prototype.fillable=!1,e.prototype.clone=function(){return new Bu.Line(this.points[0],this.points[1])},e.prototype.set=function(t,e,i,n){return"undefined"!=typeof p4&&null!==p4?(this.points[0].set(t,e),this.points[1].set(i,n)):(this.points[0]=t,this.points[1]=e),this.trigger("changed"),this},e.prototype.setPoint1=function(t,e){return null!=e?this.points[0].set(t,e):this.points[0].copy(t),this.trigger("changed"),this},e.prototype.setPoint2=function(t,e){return null!=e?this.points[1].set(t,e):this.points[1].copy(t),this.trigger("changed"),this},e}(Bu.Object2D),Bu.Point=function(t){function e(t,i){this.x=null!=t?t:0,this.y=null!=i?i:0,e.__super__.constructor.call(this),this.lineWidth=.5,this._labelIndex=-1}return h(e,t),e.prototype.type="Point",e.prototype.fillable=!0,e.prototype.clone=function(){return new Bu.Point(this.x,this.y)},e.property("label",{get:function(){return this._labelIndex>-1?this.children[this._labelIndex].text:""},set:function(t){var e;return this._labelIndex===-1?(e=new Bu.PointText(t,this.x+Bu.POINT_LABEL_OFFSET,this.y,{align:"+0"}),this.children.push(e),this._labelIndex=this.children.length-1):this.children[this._labelIndex].text=t}}),e.prototype.arcTo=function(t,e){return new Bu.Point(this.x+Math.cos(e)*t,this.y+Math.sin(e)*t)},e.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.updateLabel(),this},e.prototype.set=function(t,e){return this.x=t,this.y=e,this.updateLabel(),this},e.prototype.setLabel=function(t){return this.label=t,this.updateLabel(),this},e.prototype.updateLabel=function(){return this._labelIndex>-1&&(this.children[this._labelIndex].x=this.x+Bu.POINT_LABEL_OFFSET,this.children[this._labelIndex].y=this.y),this},e}(Bu.Object2D),Bu.Polygon=function(t){function e(t){var i,n,r,s,o;e.__super__.constructor.call(this),this.vertices=[],this.lines=[],this.triangles=[],n=Bu.combineOptions(arguments,{angle:0}),Bu.isArray(t)?null!=t&&(this.vertices=t):(arguments.length<4?(s=0,o=0,r=arguments[0],i=arguments[1]):(s=arguments[0],o=arguments[1],r=arguments[2],i=arguments[3]),this.vertices=Bu.Polygon.generateRegularPoints(s,o,r,i,n)),this.onVerticesChanged(),this.on("changed",this.onVerticesChanged),this.on("changed",function(t){return function(){var e;return null!=(e=t.bounds)?e.update():void 0}}(this)),this.keyPoints=this.vertices}return h(e,t),e.prototype.type="Polygon",e.prototype.fillable=!0,e.prototype.clone=function(){return new Bu.Polygon(this.vertices)},e.prototype.onVerticesChanged=function(){var t,e,i,n,r,s;if(this.lines=[],this.triangles=[],this.vertices.length>1){for(t=r=0,e=this.vertices.length-1;0<=e?r<e:r>e;t=0<=e?++r:--r)this.lines.push(new Bu.Line(this.vertices[t],this.vertices[t+1]));this.lines.push(new Bu.Line(this.vertices[this.vertices.length-1],this.vertices[0]))}if(this.vertices.length>2){for(n=[],t=s=1,i=this.vertices.length-1;1<=i?s<i:s>i;t=1<=i?++s:--s)n.push(this.triangles.push(new Bu.Triangle(this.vertices[0],this.vertices[t],this.vertices[t+1])));return n}},e.prototype.isSimple=function(){var t,e,i,n,r,s,o,a;for(i=this.lines.length,t=o=0,n=i;0<=n?o<n:o>n;t=0<=n?++o:--o)for(e=a=r=t+1,s=i;r<=s?a<s:a>s;e=r<=s?++a:--a)if(this.lines[t].isCrossWithLine(this.lines[e]))return!1;return!0},e.prototype.addPoint=function(t,e){return null!=e?this.vertices.splice(e,0,t):(this.vertices.push(t),this.vertices.length>1&&(this.lines[this.lines.length-1].points[1]=t),this.vertices.length>0&&this.lines.push(new Bu.Line(this.vertices[this.vertices.length-1],this.vertices[0])),this.vertices.length>2?this.triangles.push(new Bu.Triangle(this.vertices[0],this.vertices[this.vertices.length-2],this.vertices[this.vertices.length-1])):void 0)},e.generateRegularPoints=function(t,e,i,n,r){var s,o,a,h,u,c,l,p,d,f;for(o=r.angle,c=i,u=[],a=Bu.TWO_PI/n,h=p=0,l=n;0<=l?p<l:p>l;h=0<=l?++p:--p)s=h*a+o,d=t+c*Math.cos(s),f=e+c*Math.sin(s),u[h]=new Bu.Point(d,f);return u},e}(Bu.Object2D),Bu.Polyline=function(t){function e(t){var i,n,r,s;if(this.vertices=null!=t?t:[],e.__super__.constructor.call(this),arguments.length>1){for(s=[],i=r=0,n=arguments.length/2;0<=n?r<n:r>n;i=0<=n?++r:--r)s.push(new Bu.Point(arguments[2*i],arguments[2*i+1]));this.vertices=s}this.lines=[],this.keyPoints=this.vertices,this.fill(!1),this.on("changed",function(t){return function(){if(t.vertices.length>1)return t.updateLines(),"function"==typeof t.calcLength&&t.calcLength(),"function"==typeof t.calcPointNormalizedPos?t.calcPointNormalizedPos():void 0}}(this)),this.trigger("changed")}var i;return h(e,t),e.prototype.type="Polyline",e.prototype.fillable=!1,e.prototype.clone=function(){var t;return t=new Bu.Polyline(this.vertices),t.strokeStyle=this.strokeStyle,t.fillStyle=this.fillStyle,t.dashStyle=this.dashStyle,t.lineWidth=this.lineWidth,t.dashOffset=this.dashOffset,t},e.prototype.updateLines=function(){var t,e,i;for(t=i=0,e=this.vertices.length-1;0<=e?i<e:i>e;t=0<=e?++i:--i)null!=this.lines[t]?this.lines[t].set(this.vertices[t],this.vertices[t+1]):this.lines[t]=new Bu.Line(this.vertices[t],this.vertices[t+1]);return this},i=function(t){var e,i,n;for(e=n=0,i=this.vertices.length;0<=i?n<i:n>i;e=0<=i?++n:--n)this.vertices[e].copy(t[e]);return this.vertices.length>t.length&&this.vertices.splice(t.length),this.trigger("changed"),this},e.prototype.addPoint=function(t,e){return null==e?(this.vertices.push(t),this.vertices.length>1&&this.lines.push(new Bu.Line(this.vertices[this.vertices.length-2],this.vertices[this.vertices.length-1]))):this.vertices.splice(e,0,t),this.trigger("changed"),this},e}(Bu.Object2D),Bu.Rectangle=function(t){function e(t,i,n,r,s){null==s&&(s=0),e.__super__.constructor.call(this),this.center=new Bu.Point(t+n/2,i+r/2),this.size=new Bu.Size(n,r),this.pointLT=new Bu.Point(t,i),this.pointRT=new Bu.Point(t+n,i),this.pointRB=new Bu.Point(t+n,i+r),this.pointLB=new Bu.Point(t,i+r),this.points=[this.pointLT,this.pointRT,this.pointRB,this.pointLB],this.cornerRadius=s,this.on("changed",function(t){return function(){var e;return null!=(e=t.bounds)?e.update():void 0}}(this))}return h(e,t),e.prototype.type="Rectangle",e.prototype.fillable=!0,e.property("cornerRadius",{get:function(){return this._cornerRadius},set:function(t){return this._cornerRadius=t,this.keyPoints=t>0?[]:this.points}}),e.prototype.clone=function(){return new Bu.Rectangle(this.pointLT.x,this.pointLT.y,this.size.width,this.size.height)},e.prototype.set=function(t,e,i,n){return this.center.set(t+i/2,e+n/2),this.size.set(i,n),this.pointLT.set(t,e),this.pointRT.set(t+i,e),this.pointRB.set(t+i,e+n),this.pointLB.set(t,e+n)},e}(Bu.Object2D),Bu.Spline=function(t){function e(t){var n;e.__super__.constructor.call(this),t instanceof Bu.Polyline?(n=t,this.vertices=n.vertices,n.on("pointChange",function(t){return function(e){return t.vertices=e.vertices,i(t)}}(this))):this.vertices=Bu.clone(t),this.keyPoints=this.vertices,this.controlPointsAhead=[],this.controlPointsBehind=[],this.fill(!1),this.smoothFactor=Bu.DEFAULT_SPLINE_SMOOTH,this._smoother=!1,i(this)}var i;return h(e,t),e.prototype.type="Spline",e.prototype.fillable=!1,e.property("smoother",{get:function(){return this._smoother},set:function(t){var e;if(e=this._smoother,this._smoother=t,e!==this._smoother)return i(this)}}),e.prototype.clone=function(){return new Bu.Spline(this.vertices)},e.prototype.addPoint=function(t){return this.vertices.push(t),i(this)},i=function(t){var e,i,n,r,s,o,a,h,u,c,l,p,d,f,y;if(t.keyPoints=t.vertices,s=t.vertices,i=s.length,i>=1&&(t.controlPointsBehind[0]=s[0]),i>=2&&(t.controlPointsAhead[i-1]=s[i-1]),i>=3){for(a=[],e=l=1,o=i-1;1<=o?l<o:l>o;e=1<=o?++l:--l)u=Math.atan2(s[e].y-s[e-1].y,s[e].x-s[e-1].x),c=Math.atan2(s[e+1].y-s[e].y,s[e+1].x-s[e].x),n=Bu.bevel(s[e].y-s[e-1].y,s[e].x-s[e-1].x),r=Bu.bevel(s[e].y-s[e+1].y,s[e].x-s[e+1].x),h=u+(c-u)*(t._smoother?n/(n+r):.5),Math.abs(h-u)>Bu.HALF_PI&&(h+=Math.PI),p=s[e].x-n*t.smoothFactor*Math.cos(h),f=s[e].y-n*t.smoothFactor*Math.sin(h),d=s[e].x+r*t.smoothFactor*Math.cos(h),y=s[e].y+r*t.smoothFactor*Math.sin(h),t.controlPointsAhead[e]=new Bu.Point(p,f),a.push(t.controlPointsBehind[e]=new Bu.Point(d,y));return a}},e}(Bu.Object2D),Bu.Triangle=function(t){function e(t,i,n){var r,s,o,a,h,u;e.__super__.constructor.call(this),6===arguments.length&&(r=arguments[0],a=arguments[1],s=arguments[2],h=arguments[3],o=arguments[4],u=arguments[5],t=new Bu.Point(r,a),i=new Bu.Point(s,h),n=new Bu.Point(o,u)),this.lines=[new Bu.Line(t,i),new Bu.Line(i,n),new Bu.Line(n,t)],this.points=[t,i,n],this.keyPoints=this.points,this.on("changed",this.update),this.on("changed",function(t){return function(){var e;return null!=(e=t.bounds)?e.update():void 0}}(this))}return h(e,t),e.prototype.type="Triangle",e.prototype.fillable=!0,e.prototype.clone=function(){return new Bu.Triangle(this.points[0],this.points[1],this.points[2])},e.prototype.update=function(){return this.lines[0].points[0].copy(this.points[0]),this.lines[0].points[1].copy(this.points[1]),this.lines[1].points[0].copy(this.points[1]),this.lines[1].points[1].copy(this.points[2]),this.lines[2].points[0].copy(this.points[2]),this.lines[2].points[1].copy(this.points[0])},e}(Bu.Object2D),Bu.Image=function(t){function e(t,i,n,r,s){this.url=t,null==i&&(i=0),null==n&&(n=0),e.__super__.constructor.call(this),this.type="Image",this.autoSize=!0,this.size=new Bu.Size,this.position=new Bu.Vector(i,n),this.center=new Bu.Vector(i+r/2,n+s/2),null!=r&&(this.size.set(r,s),this.autoSize=!1),this.pivot=new Bu.Vector(.5,.5),this._image=new Bu.global.Image,this.ready=!1,this._image.onload=function(t){return function(e){return t.autoSize&&t.size.set(t._image.width,t._image.height),t.ready=!0}}(this),null!=this.url&&(this._image.src=this.url)}return h(e,t),e.property("image",{get:function(){return this._image},set:function(t){return this._image=t,this.ready=!0}}),e}(Bu.Object2D),Bu.PointText=function(t){function e(t,i,n){var r;this.text=t,this.x=null!=i?i:0,this.y=null!=n?n:0,e.__super__.constructor.call(this),this.type="PointText",this.strokeStyle=null,this.fillStyle="black",r=Bu.combineOptions(arguments,{align:"00"}),this.align=r.align,null!=r.font?this.font=r.font:null!=r.fontFamily||null!=r.fontSize?(this._fontFamily=r.fontFamily||Bu.DEFAULT_FONT_FAMILY,this._fontSize=r.fontSize||Bu.DEFAULT_FONT_SIZE,this.font=this._fontSize+"px "+this._fontFamily):this.font=null}return h(e,t),e.property("align",{get:function(){return this._align},set:function(t){return this._align=t,this.setAlign(this._align)}}),e.property("fontFamily",{get:function(){return this._fontFamily},set:function(t){return this._fontFamily=t,this.font=this._fontSize+"px "+this._fontFamily}}),e.property("fontSize",{get:function(){return this._fontSize},set:function(t){return this._fontSize=t,this.font=this._fontSize+"px "+this._fontFamily}}),e.prototype.setAlign=function(t){var e,i;return 1===t.length&&(t=""+t+t),e=t.substring(0,1),i=t.substring(1,2),this.textAlign=function(){switch(e){case"-":return"right";case"0":return"center";case"+":return"left"}}(),this.textBaseline=function(){switch(i){case"-":return"bottom";case"0":return"middle";case"+":return"top"}}(),this},e.prototype.setFontFamily=function(t){return this.fontFamily=t,this},e.prototype.setFontSize=function(t){return this.fontSize=t,this},e}(Bu.Object2D),Bu.Animation=function(){function t(t){this.from=t.from,this.to=t.to,this.duration=t.duration||.5,this.easing=t.easing||!1,this.repeat=!!t.repeat,this.init=t.init,this.update=t.update,this.finish=t.finish}return t.prototype.applyTo=function(t,e){var i;return Bu.isArray(e)||(e=[e]),i=new Bu.AnimationTask(this,t,e),Bu.animationRunner.add(i),i},t.prototype.isLegal=function(){var t,e;if(null==this.from||null==this.to)return!0;if(Bu.isPlainObject(this.from)){e=this.from;for(t in e)if(o.call(e,t)&&null==this.to[t])return!1}else if(null==this.to)return!1;return!0},t}(),Bu.animations={fadeIn:new Bu.Animation({update:function(t){return this.opacity=t.t}}),fadeOut:new Bu.Animation({update:function(t){return this.opacity=1-t.t}}),spin:new Bu.Animation({update:function(t){return this.rotation=t.t*Math.PI*2}}),spinIn:new Bu.Animation({init:function(t){return t.data.desScale=t.arg||1},update:function(t){return this.opacity=t.t,this.rotation=t.t*Math.PI*4,this.scale=t.t*t.data.desScale}}),spinOut:new Bu.Animation({update:function(t){return this.opacity=1-t.t,this.rotation=t.t*Math.PI*4,this.scale=1-t.t}}),blink:new Bu.Animation({duration:.2,from:0,to:512,update:function(t){var e;return e=Math.floor(Math.abs(t.current-256)),this.fillStyle="rgb("+e+", "+e+", "+e+")"}}),shake:new Bu.Animation({init:function(t){return t.data.ox=this.position.x,t.data.range=t.arg||20},update:function(t){return this.position.x=Math.sin(t.t*Math.PI*8)*t.data.range+t.data.ox}}),jump:new Bu.Animation({init:function(t){return t.data.oy=this.position.y,t.data.height=t.arg||100},update:function(t){return this.position.y=-t.data.height*Math.sin(t.t*Math.PI)+t.data.oy}}),puff:new Bu.Animation({duration:.15,init:function(t){return t.from={opacity:this.opacity,scale:this.scale.x},t.to=1===this.opacity?{opacity:0,scale:1.5*this.scale.x}:{opacity:1,scale:this.scale.x/1.5}},update:function(t){return this.opacity=t.current.opacity,this.scale=t.current.scale}}),clip:new Bu.Animation({init:function(t){return 0!==this.scale.y?(t.from=this.scale.y,t.to=0):(t.from=this.scale.y,t.to=this.scale.x)},update:function(t){return this.scale.y=t.current}}),flipX:new Bu.Animation({init:function(t){return t.from=this.scale.x,t.to=-t.from},update:function(t){return this.scale.x=t.current}}),flipY:new Bu.Animation({init:function(t){return t.from=this.scale.y,t.to=-t.from},update:function(t){return this.scale.y=t.current}}),moveTo:new Bu.Animation({init:function(t){return null!=t.arg?(t.from=this.position.x,t.to=parseFloat(t.arg)):console.error("Bu.animations.moveTo need an argument")},update:function(t){return this.position.x=t.current}}),moveBy:new Bu.Animation({init:function(t){return null!=t.args?(t.from=this.position.x,t.to=this.position.x+parseFloat(t.args)):console.error("Bu.animations.moveBy need an argument")},update:function(t){return this.position.x=t.current}}),discolor:new Bu.Animation({init:function(t){var e;return e=t.arg,Bu.isString(e)&&(e=new Bu.Color(e)),t.from=new Bu.Color(this.fillStyle),t.to=e},update:function(t){return this.fillStyle=t.current.toRGBA()}})},Bu.AnimationRunner=function(){function t(){this.runningAnimations=[]}var e,i;return t.prototype.add=function(t){return t.init(),t.animation.isLegal()?(t.startTime=Bu.now(),this.runningAnimations.push(t)):console.error("Bu.AnimationRunner: animation setting is illegal: ",t.animation)},t.prototype.update=function(){var t,n,r,s,o,a,h,u,c,l;for(s=Bu.now(),o=this.runningAnimations,h=[],l=0,r=o.length;l<r;l++)c=o[l],c.finished||(t=c.animation,u=(s-c.startTime)/(1e3*t.duration),u>=1&&(n=!0,t.repeat?(u=0,c.startTime=Bu.now()):(u=1,c.finished=!0)),t.easing===!0?u=i[e](u):null!=i[t.easing]&&(u=i[t.easing](u)),c.t=u,c.interpolate(),t.update.call(c.target,c),n?h.push(null!=(a=t.finish)?a.call(c.target,c):void 0):h.push(void 0));return h},t.prototype.hookUp=function(t){return t.on("update",function(t){return function(){return t.update()}}(this))},e="quad",i={quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quad:function(t){return t<.5?2*t*t:-2*t*t+4*t-1},cubicIn:function(t){return Math.pow(t,3)},cubicOut:function(t){return Math.pow(t-1,3)+1},cubic:function(t){return t<.5?4*Math.pow(t,3):4*Math.pow(t-1,3)+1},sineIn:function(t){return Math.sin((t-1)*Bu.HALF_PI)+1},sineOut:function(t){return Math.sin(t*Bu.HALF_PI)},sine:function(t){return t<.5?(Math.sin((2*t-1)*Bu.HALF_PI)+1)/2:Math.sin((t-.5)*Math.PI)/2+.5}},t}(),Bu.animationRunner=new Bu.AnimationRunner,Bu.AnimationTask=function(){function t(t,e,i){this.animation=t,this.target=e,this.args=null!=i?i:[],this.startTime=0,this.finished=!1,this.from=Bu.clone(this.animation.from),this.current=Bu.clone(this.animation.from),this.to=Bu.clone(this.animation.to),this.data={},this.t=0,this.arg=this.args[0]}var e,i,n;return t.prototype.init=function(){var t;return null!=(t=this.animation.init)&&t.call(this.target,this),this.current=Bu.clone(this.from)},t.prototype.restart=function(){return this.startTime=Bu.now(),this.finished=!1},t.prototype.end=function(){return this.startTime=Bu.now()-1e3*this.animation.duration},t.prototype.interpolate=function(){var t,r,s;if(null!=this.from){if(Bu.isNumber(this.from))return this.current=i(this.from,this.to,this.t);if(this.from instanceof Bu.Color)return e(this.from,this.to,this.t,this.current);if(this.from instanceof Bu.Vector)return n(this.from,this.to,this.t,this.current);if(Bu.isPlainObject(this.from)){r=this.from,s=[];for(t in r)o.call(r,t)&&(Bu.isNumber(this.from[t])?s.push(this.current[t]=i(this.from[t],this.to[t],this.t)):s.push(interpolateObject(this.from[t],this.to[t],this.t,this.current[t])));return s}return console.error("Bu.Animation not support interpolate type: ",this.from)}},i=function(t,e,i){return e*i-t*(i-1)},e=function(t,e,n,r){return r.setRGBA(i(t.r,e.r,n),i(t.g,e.g,n),i(t.b,e.b,n),i(t.a,e.a,n))},n=function(t,e,n,r){return r.x=i(t.x,e.x,n),r.y=i(t.y,e.y,n)},t}(),Bu.DashFlowManager=function(){function t(){this.flowingObjects=[]}return t.prototype.setSpeed=function(t,e){var i;if(t.dashFlowSpeed=e,i=this.flowingObjects.indexOf(t),0!==e){if(i===-1)return this.flowingObjects.push(t)}else if(i>-1)return this.flowingObjects.splice(i,1)},t.prototype.update=function(){var t,e,i,n,r;for(i=this.flowingObjects,n=[],r=0,t=i.length;r<t;r++)e=i[r],n.push(e.dashOffset+=e.dashFlowSpeed);return n},t.prototype.hookUp=function(t){return t.on("update",function(t){return function(){return t.update()}}(this))},t}(),Bu.dashFlowManager=new Bu.DashFlowManager,Bu.SpriteSheet=function(){function t(t){this.url=t,Bu.Event.apply(this),this.ready=!1,this.height=0,this.data=null,this.images=[],this.frameImages=[],$.ajax(this.url,{success:function(t){return function(e){var i,n,r,s,a;t.data=JSON.parse(e),null==t.data.images&&(t.data.images=[t.url.substring(t.url.lastIndexOf("/"),t.url.length-5)+".png"]),i=t.url.substring(0,t.url.lastIndexOf("/")+1),s=t.data.images,a=[];for(r in s)o.call(s,r)&&(t.data.images[r]=i+t.data.images[r],n=0,t.images[r]=new Image,t.images[r].onload=function(){if(n+=1,n===t.data.images.length)return t.parseData()},a.push(t.images[r].src=t.data.images[r]));return a}}(this)})}var e,i,n;return t.prototype.parseData=function(){var t,e,n,r,s,a,h,u,c,l;e=this.data.frames;for(r in e)if(o.call(e,r)){for(s=h=0;h<=4;s=++h)null==e[r][s]&&(e[r][s]=null!=(null!=(a=e[r-1])?a[s]:void 0)?e[r-1][s]:0);c=e[r][0],l=e[r][1],u=e[r][2],n=e[r][3],t=e[r][4],this.frameImages[r]=i(this.images[t],c,l,u,n),0===this.height&&(this.height=n)}return this.ready=!0,this.trigger("loaded")},t.prototype.getFrameImage=function(t,e){var i;return null==e&&(e=0),this.ready?(i=this.data.animations[t],null==i?null:this.frameImages[i.frames[e]]):null},t.prototype.measureTextWidth=function(t){var e,i,n,r;for(r=0,n=0,i=t.length;n<i;n++)e=t[n],r+=this.getFrameImage(e).width;return r},e=document.createElement("canvas"),n=e.getContext("2d"),i=function(t,i,r,s,o){var a;return e.width=s,e.height=o,n.drawImage(t,i,r,s,o,0,0,s,o),a=new Image,a.src=e.toDataURL(),a},t}(),Bu.InputManager=function(){function t(){this.keyStates=[],window.addEventListener("keydown",function(t){return function(e){return t.keyStates[e.keyCode]=!0}}(this)),window.addEventListener("keyup",function(t){return function(e){return t.keyStates[e.keyCode]=!1}}(this))}return t.prototype.isKeyDown=function(t){var e;return e=this.keyToKeyCode(t),this.keyStates[e]},t.prototype.keyToKeyCode=function(t){var e;return t=this.keyAliasToKeyMap[t]||t,e=this.keyToKeyCodeMap[t]},t.prototype.handleAppEvents=function(t,e){var i,n,r,s,o,a;r={},s={},window.addEventListener("keydown",function(e){return function(e){var i;return null!=(i=r[e.keyCode])?i.call(t,e):void 0}}(this)),window.addEventListener("keyup",function(e){return function(e){var i;return null!=(i=s[e.keyCode])?i.call(t,e):void 0}}(this)),o=[];for(a in e)"mousedown"===a||"mousemove"===a||"mouseup"===a||"mousewheel"===a?o.push(t.$renderer.dom.addEventListener(a,e[a].bind(t))):"keydown"===a||"keyup"===a?o.push(window.addEventListener(a,e[a].bind(t))):0===a.indexOf("keydown.")?(i=a.substring(8),n=this.keyToKeyCode(i),o.push(r[n]=e[a])):0===a.indexOf("keyup.")?(i=a.substring(6),n=this.keyToKeyCode(i),o.push(s[n]=e[a])):o.push(void 0);return o},t.prototype.keyToKeyCodeMap={Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,CapsLock:20,Escape:27," ":32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Delete:46,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,",":188,"-":189,".":190,"/":191,";":186,"'":222,"[":219,"]":221,"\\":220},t.prototype.keyAliasToKeyMap={Ctrl:"Control",Ctl:"Control",Esc:"Escape",Space:" ",PgUp:"PageUp","Page Up":"PageUp",PgDn:"PageDown","Page Down":"PageDown",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete"},t}(),Bu.MouseControl=function(){function t(t,n){this.camera=t,this.onMouseWheel=a(this.onMouseWheel,this),this.onMouseMove=a(this.onMouseMove,this),this.zoomScaleAnim=e.applyTo(this.camera),this.zoomTransAnim=i.applyTo(this.camera),this.smoothZooming=!0,this.desScale=new Bu.Vector(1,1),n.addEventListener("mousemove",this.onMouseMove),n.addEventListener("mousewheel",this.onMouseWheel)}var e,i;return e=new Bu.Animation({duration:.2,init:function(t){return null==t.arg&&(t.arg=1),t.from=this.scale.clone(),t.to=this.scale.clone().multiplyScalar(parseFloat(t.arg))},update:function(t){return this.scale=t.current}}),i=new Bu.Animation({duration:.2,init:function(t){return null==t.arg&&(t.arg=new Bu.Vector),t.from=this.position.clone(),t.to=this.position.clone().add(t.arg)},update:function(t){return this.position.copy(t.current)}}),t.prototype.onMouseMove=function(t){var e,i,n;if(t.buttons===Bu.MOUSE.LEFT)return n=this.camera.scale.x,e=-t.movementX*n,i=-t.movementY*n,this.camera.translate(e,i)},t.prototype.onMouseWheel=function(t){var e,i,n,r,s,o;return i=Math.pow(1.25,-t.wheelDelta/120),this.desScale.multiplyScalar(i),e=this.desScale.x/this.camera.scale.x,s=t.offsetX-$(t.target).width()/2,o=t.offsetY-$(t.target).height()/2,n=-s*(e-1)*this.camera.scale.x,r=-o*(e-1)*this.camera.scale.y,this.smoothZooming?(this.zoomScaleAnim.from.copy(this.camera.scale),this.zoomScaleAnim.to.copy(this.desScale),this.zoomScaleAnim.restart(),this.zoomTransAnim.from.copy(this.camera.position),this.zoomTransAnim.to.set(this.camera.position.x+n,this.camera.position.y+r),this.zoomTransAnim.restart()):(this.camera.translate(n,r),this.camera.scale.copy(this.desScale))},t}(),Bu.geometryAlgorithm=t={inject:function(){return this.injectInto(["point","line","circle","ellipse","triangle","rectangle","fan","bow","polygon","polyline"])},injectInto:function(e){if(Bu.isString(e)&&(e=[e]),u.call(e,"point")>=0&&(Bu.Point.prototype.inCircle=function(e){return t.pointInCircle(this,e)},Bu.Point.prototype.distanceTo=function(e){return t.distanceFromPointToPoint(this,e)},Bu.Point.prototype.isNear=function(e,i){switch(null==i&&(i=Bu.DEFAULT_NEAR_DIST),e.type){case"Point":return t.pointNearPoint(this,e,i);case"Line":return t.pointNearLine(this,e,i);case"Polyline":return t.pointNearPolyline(this,e,i)}},Bu.Point.interpolate=t.interpolateBetweenTwoPoints),u.call(e,"line")>=0&&(Bu.Line.prototype.distanceTo=function(e){return t.distanceFromPointToLine(e,this)},Bu.Line.prototype.isTwoPointsSameSide=function(e,i){return t.twoPointsSameSideOfLine(e,i,this)},Bu.Line.prototype.footPointFrom=function(e,i){return t.footPointFromPointToLine(e,this,i)},Bu.Line.prototype.getCrossPointWith=function(e){return t.getCrossPointOfTwoLines(e,this)},Bu.Line.prototype.isCrossWithLine=function(e){return t.isTwoLinesCross(e,this)},Bu.Rectangle.prototype.intersectRect=function(e){return t.isLineIntersectRect(this,e)}),u.call(e,"circle")>=0&&(Bu.Circle.prototype._containsPoint=function(e){return t.pointInCircle(e,this)}),u.call(e,"ellipse")>=0&&(Bu.Ellipse.prototype._containsPoint=function(e){return t.pointInEllipse(e,this)}),u.call(e,"triangle")>=0&&(Bu.Triangle.prototype._containsPoint=function(e){return t.pointInTriangle(e,this)},Bu.Triangle.prototype.area=function(){return t.calcTriangleArea(this)}),u.call(e,"rectangle")>=0&&(Bu.Rectangle.prototype.containsPoint=function(e){return t.pointInRectangle(e,this)},Bu.Rectangle.prototype.intersectLine=function(e){return t.isLineIntersectRect(e,this)}),u.call(e,"fan")>=0&&(Bu.Fan.prototype._containsPoint=function(e){return t.pointInFan(e,this)}),u.call(e,"bow")>=0&&(Bu.Bow.prototype._containsPoint=function(e){return t.pointInBow(e,this)}),u.call(e,"polygon")>=0&&(Bu.Polygon.prototype._containsPoint=function(e){return t.pointInPolygon(e,this)}),u.call(e,"polyline")>=0)return Bu.Polyline.prototype.length=0,Bu.Polyline.prototype.pointNormalizedPos=[],Bu.Polyline.prototype.calcLength=function(){return this.length=t.calcPolylineLength(this)},Bu.Polyline.prototype.calcPointNormalizedPos=function(){return t.calcNormalizedVerticesPosOfPolyline(this)},Bu.Polyline.prototype.getNormalizedPos=function(t){return null!=t?this.pointNormalizedPos[t]:this.pointNormalizedPos},Bu.Polyline.prototype.compress=function(e){return null==e&&(e=.8),t.compressPolyline(this,e)}},pointNearPoint:function(t,e,i){return null==i&&(i=Bu.DEFAULT_NEAR_DIST),t.distanceTo(e)<i},pointNearLine:function(t,e,i){var n,r,s,o;return null==i&&(i=Bu.DEFAULT_NEAR_DIST),o=e.distanceTo(t),n=e.footPointFrom(t),r=n.distanceTo(e.points[0])<e.length+i,s=n.distanceTo(e.points[1])<e.length+i,o<i&&r&&s},pointNearPolyline:function(e,i,n){var r,s,o,a;for(null==n&&(n=Bu.DEFAULT_NEAR_DIST),o=i.lines,a=0,r=o.length;a<r;a++)if(s=o[a],t.pointNearLine(e,s,n))return!0;return!1},pointInCircle:function(t,e){var i,n;return i=t.x-e.cx,n=t.y-e.cy,Bu.bevel(i,n)<e.radius},pointInEllipse:function(t,e){return Bu.bevel(t.x/e.radiusX,t.y/e.radiusY)<1},pointInRectangle:function(t,e){return t.x>e.pointLT.x&&t.y>e.pointLT.y&&t.x<e.pointLT.x+e.size.width&&t.y<e.pointLT.y+e.size.height},pointInTriangle:function(e,i){return t.twoPointsSameSideOfLine(e,i.points[2],i.lines[0])&&t.twoPointsSameSideOfLine(e,i.points[0],i.lines[1])&&t.twoPointsSameSideOfLine(e,i.points[1],i.lines[2])},pointInFan:function(t,e){var i,n,r;for(n=t.x-e.cx,r=t.y-e.cy,i=Math.atan2(t.y-e.cy,t.x-e.cx);i<e.aFrom;)i+=Bu.TWO_PI;return Bu.bevel(n,r)<e.radius&&i>e.aFrom&&i<e.aTo},pointInBow:function(t,e){var i,n;return Bu.bevel(e.cx-t.x,e.cy-t.y)<e.radius&&(i=e.string.isTwoPointsSameSide(e.center,t),n=e.aTo-e.aFrom<Math.PI,i^n)},pointInPolygon:function(t,e){var i,n,r,s;for(n=e.triangles,s=0,i=n.length;s<i;s++)if(r=n[s],r.containsPoint(t))return!0;return!1},distanceFromPointToPoint:function(t,e){return Bu.bevel(t.x-e.x,t.y-e.y)},distanceFromPointToLine:function(t,e){var i,n,r,s;return r=e.points[0],s=e.points[1],i=(r.y-s.y)/(r.x-s.x),n=r.y-i*r.x,Math.abs(i*t.x+n-t.y)/Math.sqrt(i*i+1)},interpolateBetweenTwoPoints:function(t,e,i,n){var r,s;return r=t.x+(e.x-t.x)*i,s=t.y+(e.y-t.y)*i,null!=n?n.set(r,s):new Bu.Point(r,s)},twoPointsSameSideOfLine:function(t,e,i){var n,r,s,o;return n=i.points[0],r=i.points[1],n.x===r.x?(t.x-n.x)*(e.x-n.x)>0:(s=(n.y-r.y)*(t.x-n.x)/(n.x-r.x)+n.y,o=(n.y-r.y)*(e.x-n.x)/(n.x-r.x)+n.y,(t.y-s)*(e.y-o)>0)},footPointFromPointToLine:function(t,e,i){var n,r,s,o,a,h,u;return null==i&&(i=new Bu.Point),o=e.points[0],a=e.points[1],n=(o.y-a.y)/(o.x-a.x),r=o.y-n*o.x,s=t.x+n*t.y,h=(s-n*r)/(n*n+1),u=n*h+r,i.set(h,u),i},getCrossPointOfTwoLines:function(t,e){var i,n,r,s,o,a,h,u,c,l,p,d,f;return d=t.points,u=d[0],c=d[1],f=e.points,l=f[0],p=f[1],i=c.y-u.y,r=u.x-c.x,o=i*u.x+r*u.y,n=p.y-l.y,s=l.x-p.x,a=n*l.x+s*l.y,h=i*s-n*r,new Bu.Point((s*o-r*a)/h,(i*a-n*o)/h)},isTwoLinesCross:function(t,e){var i,n,r,s,o,a,h,u,c,l,p;return r=t.points[0].x,u=t.points[0].y,s=t.points[1].x,c=t.points[1].y,o=e.points[0].x,l=e.points[0].y,a=e.points[1].x,p=e.points[1].y,i=(c-u)*(a-o)-(p-l)*(s-r),0!==i&&(n=((s-r)*(a-o)*(l-u)+(c-u)*(a-o)*r-(p-l)*(s-r)*o)/i,h=((c-u)*(p-l)*(o-r)+(s-r)*(p-l)*u-(a-o)*(c-u)*l)/-i,(n-r)*(n-s)<=0&&(n-o)*(n-a)<=0&&(h-u)*(h-c)<=0&&(h-l)*(h-p)<=0)},isLineIntersectRect:function(e,i){var n;return n=[new Bu.Line,new Bu.Line,new Bu.Line,new Bu.Line],n[0].set(i.points[0],i.points[1]),n[1].set(i.points[1],i.points[2]),
n[2].set(i.points[2],i.points[3]),n[3].set(i.points[3],i.points[0]),t.isTwoLinesCross(e,n[0])||t.isTwoLinesCross(e,n[1])||t.isTwoLinesCross(e,n[2])||t.isTwoLinesCross(e,n[3])},calcPolylineLength:function(t){var e,i,n,r;if(i=0,t.vertices.length>=2)for(e=r=1,n=t.vertices.length;1<=n?r<n:r>n;e=1<=n?++r:--r)i+=t.vertices[e].distanceTo(t.vertices[e-1]);return i},calcNormalizedVerticesPosOfPolyline:function(t){var e,i,n,r,s;for(e=0,t.pointNormalizedPos[0]=0,r=[],i=s=1,n=t.vertices.length;1<=n?s<n:s>n;i=1<=n?++s:--s)e+=t.vertices[i].distanceTo(t.vertices[i-1])/t.length,r.push(t.pointNormalizedPos[i]=e);return r},compressPolyline:function(t,e){var i,n,r,s,a,h,u,c;i=[],u=t.vertices;for(n in u)o.call(u,n)&&(n<2?i[n]=t.vertices[n]:(c=i.slice(-2),s=c[0],h=c[1],a=t.vertices[n],r=Math.abs(Math.atan2(s.y-h.y,s.x-h.x)-Math.atan2(h.y-a.y,h.x-a.x)),r<e*e*Bu.HALF_PI?i[i.length-1]=a:i.push(a)));return t.vertices=i,t.keyPoints=t.vertices,t},calcTriangleArea:function(t){var e,i,n,r;return r=t.points,e=r[0],i=r[1],n=r[2],Math.abs((i.x-e.x)*(n.y-e.y)-(n.x-e.x)*(i.y-e.y))/2}},t.inject(),Bu.ShapeRandomizer=function(){function t(){}var e;return e=30,t.prototype.rangeX=0,t.prototype.rangeY=0,t.prototype.rangeWidth=800,t.prototype.rangeHeight=450,t.prototype.randomX=function(){return Bu.rand(this.rangeX+e,this.rangeX+this.rangeWidth-2*e)},t.prototype.randomY=function(){return Bu.rand(this.rangeY+e,this.rangeY+this.rangeHeight-2*e)},t.prototype.randomRadius=function(){return Bu.rand(10,Math.min(this.rangeX+this.rangeWidth,this.rangeY+this.rangeHeight)/2)},t.prototype.setRange=function(t,e,i,n){return null!=i?(this.rangeX=t,this.rangeY=e,this.rangeWidth=i,this.rangeHeight=n):(this.rangeWidth=t,this.rangeHeight=e),this},t.prototype.generate=function(t){switch(t){case"circle":return this.generateCircle();case"bow":return this.generateBow();case"triangle":return this.generateTriangle();case"rectangle":return this.generateRectangle();case"fan":return this.generateFan();case"polygon":return this.generatePolygon();case"line":return this.generateLine();case"polyline":return this.generatePolyline();default:return console.warn("not support shape: "+t)}},t.prototype.randomize=function(t){var e,i,n;if(Bu.isArray(t))for(n=0,e=t.length;n<e;n++)i=t[n],this.randomize(i);else switch(t.type){case"Circle":this.randomizeCircle(t);break;case"Ellipse":this.randomizeEllipse(t);break;case"Bow":this.randomizeBow(t);break;case"Triangle":this.randomizeTriangle(t);break;case"Rectangle":this.randomizeRectangle(t);break;case"Fan":this.randomizeFan(t);break;case"Polygon":this.randomizePolygon(t);break;case"Line":this.randomizeLine(t);break;case"Polyline":this.randomizePolyline(t);break;default:console.warn("not support shape: "+t.type)}return this},t.prototype.randomizePosition=function(t){return t.position.x=this.randomX(),t.position.y=this.randomY(),t.trigger("changed"),this},t.prototype.generateCircle=function(){var t;return t=new Bu.Circle(this.randomRadius(),this.randomX(),this.randomY()),t.center.label="O",t},t.prototype.randomizeCircle=function(t){return t.cx=this.randomX(),t.cy=this.randomY(),t.radius=this.randomRadius(),this},t.prototype.generateEllipse=function(){var t;return t=new Bu.Ellipse(this.randomRadius(),this.randomRadius()),this.randomizePosition(t),t},t.prototype.randomizeEllipse=function(t){return t.radiusX=this.randomRadius(),t.radiusY=this.randomRadius(),this.randomizePosition(t),this},t.prototype.generateBow=function(){var t,e,i;return t=Bu.rand(Bu.TWO_PI),e=t+Bu.rand(Bu.HALF_PI,Bu.TWO_PI),i=new Bu.Bow(this.randomX(),this.randomY(),this.randomRadius(),t,e),i.string.points[0].label="A",i.string.points[1].label="B",i},t.prototype.randomizeBow=function(t){var e,i;return e=Bu.rand(Bu.TWO_PI),i=e+Bu.rand(Bu.HALF_PI,Bu.TWO_PI),t.cx=this.randomX(),t.cy=this.randomY(),t.radius=this.randomRadius(),t.aFrom=e,t.aTo=i,t.trigger("changed"),this},t.prototype.generateFan=function(){var t,e,i;return t=Bu.rand(Bu.TWO_PI),e=t+Bu.rand(Bu.HALF_PI,Bu.TWO_PI),i=new Bu.Fan(this.randomX(),this.randomY(),this.randomRadius(),t,e),i.center.label="O",i.string.points[0].label="A",i.string.points[1].label="B",i},t.prototype.randomizeFan=t.prototype.randomizeBow,t.prototype.generateTriangle=function(){var t,e,i,n;for(e=[],t=n=0;n<=2;t=++n)e[t]=new Bu.Point(this.randomX(),this.randomY());return i=new Bu.Triangle(e[0],e[1],e[2]),i.points[0].label="A",i.points[1].label="B",i.points[2].label="C",i},t.prototype.randomizeTriangle=function(t){var e,i;for(e=i=0;i<=2;e=++i)t.points[e].set(this.randomX(),this.randomY());return t.trigger("changed"),this},t.prototype.generateRectangle=function(){var t;return t=new Bu.Rectangle(Bu.rand(this.rangeX+this.rangeWidth),Bu.rand(this.rangeY+this.rangeHeight),Bu.rand(this.rangeWidth/2),Bu.rand(this.rangeHeight/2)),t.pointLT.label="A",t.pointRT.label="B",t.pointRB.label="C",t.pointLB.label="D",t},t.prototype.randomizeRectangle=function(t){return t.set(this.randomX(),this.randomY(),this.randomRadius(),this.randomRadius()),t.trigger("changed"),this},t.prototype.generatePolygon=function(){var t,e,i,n;for(i=[],t=n=0;n<=3;t=++n)e=new Bu.Point(this.randomX(),this.randomY()),e.label="P"+t,i.push(e);return new Bu.Polygon(i)},t.prototype.randomizePolygon=function(t){var e,i,n,r;for(i=t.vertices,n=0,e=i.length;n<e;n++)r=i[n],r.set(this.randomX(),this.randomY());return t.trigger("changed"),this},t.prototype.generateLine=function(){var t;return t=new Bu.Line(this.randomX(),this.randomY(),this.randomX(),this.randomY()),t.points[0].label="A",t.points[1].label="B",t},t.prototype.randomizeLine=function(t){var e,i,n,r;for(n=t.points,r=0,e=n.length;r<e;r++)i=n[r],i.set(this.randomX(),this.randomY());return t.trigger("changed"),this},t.prototype.generatePolyline=function(){var t,e,i,n;for(i=new Bu.Polyline,t=n=0;n<=3;t=++n)e=new Bu.Point(this.randomX(),this.randomY()),e.label="P"+t,i.addPoint(e);return i},t.prototype.randomizePolyline=function(t){var e,i,n,r;for(i=t.vertices,n=0,e=i.length;n<e;n++)r=i[n],r.set(this.randomX(),this.randomY());return t.trigger("changed"),this},t}()}).call(this);