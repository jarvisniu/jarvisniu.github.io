/**********************************************************
 * Geometry Math Calculations
 * Author: BJ Niu
 * Date: 2014/2/19
 * version update:
 *   degToRad(),
 **********************************************************
 */
var D2R = Math.PI / 180;
var R2D = 180.0 / Math.PI;
var PI2 = Math.PI / 2;
var PI4 = Math.PI / 4;
var PI360 = Math.PI / 360;
var PIInv = 1 / Math.PI;

var pow2 = [];
for (var i = 0; i < 30; i++) {
    pow2[i] = Math.pow(2, i);
}

// degree & radius
function degToRad(degree) {
    return degree * D2R;
}

function radToDeg(radius) {
    return radius * R2D;
}

// lat lng & gx gy
function lng2x(lat, level) {
    return (lat + 180) / 360 * pow2[level];
}

function lat2y(lng, level) {
    var per = 0.5 - 0.5 * Math.log(Math.tan(PI4 + lng * PI360 )) * PIInv;
    return per * pow2[level];
}

function x2lng(x, level) {
    return x * 360 / pow2[level] - 180;
}

function y2lat(y, level) {
    return (2 * Math.atan(Math.exp((1 - y * 2 / pow2[level]) * Math.PI)) - PI2) * R2D;
}

//lat lng & meter
// 1 deg = 100km
/**
 * Coordinates converter, between Local(Distance) and LatLon
 * @param lng
 * @returns {number}
 */
function lng2mx(lng) {
    return lng * 100000;
}
function lat2my(lat) {
    return lat * 100000;
}
function mx2lng(mx) {
    return mx / 100000;
}
function my2lat(my) {
    return my / 100000;
}

/**
 * Get the tile index of a geography coordinate.
 *
 * @param latLon {object} Object that contains the lon and lat attributes.
 * @param level {int} The destination zoom level.
 */
function getTileIndexFromLonLat(latLon, level) {
    var indexObj = {};
    indexObj.deciX = lng2x(latLon.lon, level);
    indexObj.deciY = lat2y(latLon.lat, level);
    indexObj.x = Math.floor(indexObj.deciX);
    indexObj.y = Math.floor(indexObj.deciY);
    indexObj.fracX = indexObj.deciX - indexObj.x;
    indexObj.fracY = indexObj.deciY - indexObj.y;
    return indexObj;
}

//math
function round2(original) {
    return Math.round(parseFloat(original) * 100) / 100;
}

function getSign(num) {
    if(num > 0) {
        return 1;
    } else if(num < 0) {
        return -1;
    } else {
        return 0;
    }
}

function getDecimal(f) {
    return f - parseInt(f);
}