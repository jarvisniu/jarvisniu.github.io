边界选取
=======

在地图上选取（绘制）区域的边界。

## 注意

本例未使用Google Maps API来实现地图显示（使用BJ写的BjCvsMap.js库）。
但依然需要翻墙，以便从谷歌服务器获取图块数据。

## DEMO

请见DEMO.htm。

## 涉及到的JS库

本DEMO总共涉及到了3个JS库：

1. BjCvsMap-1.1.0.js
2. TileProvider-1.4.0.js
3. Geography-2.0.0.js


### 1.BjCvsMap

该库用来显示地图、绘制区域。
该库通过公共变量regions作为区域信息交换的API接口。
该公共变量包含地图上用户绘制的区域的边界点的经纬度坐标。
在console中输入regions来查看该变量的结构。


### 2.TileProvider

在下载图块的例子中该模块单独使用。
在本例中，该库用来给BjCvsMap提供图块下载服务。

### 3. Geometry

地理坐标与图块索引的转换。
凡是同时用到图块和经纬度的地方，都需要使用该库。

## 多边形绘制原理

### 添加点

在鼠标点击事件中，将屏幕坐标转换为图块索引，再转换为经纬度坐标，压入多边形顶点的数组。

### 移动点

在鼠标移动事件中，检测鼠标当前所在位置是否有多边形顶点在附近。有则把该点的索引记录到一个变量（本例为indexSelectedPoint）中。

在鼠标拖拽移动时，如果indexSelectedPoint为-1，则未选中点，执行平移地图的功能。否则，执行移动点的功能。

### 从边线拖拽，插入点

同移动点类似，在鼠标移动事件中，检测鼠标当前所在位置是否有多边形边线在附近。有则把该边线的索引记录到一个变量（本例为mousePos.LineIndex）中。

在鼠标拖拽移动时，如果mousePos.LineIndex为-1，则未选中边线，执行平移地图的功能。否则，执行从边线插入顶点的功能。

